<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#658161" />
  <title id="page-title">Hist√≥rias do Campo Mission√°rio</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Open+Sans:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    /* Mantendo o mesmo CSS do original para coer√™ncia */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      overflow-x: hidden;
    }
    html {
      font-size: 16px;
    }
    body {
      font-family: 'Open Sans', Arial, sans-serif;
      background: url("imagens/fundo_historia.png") center center / cover no-repeat;
      color: #000000;
      line-height: 1.6;
    }
    a {
      text-decoration: none;
      color: inherit;
    }
    ul {
      list-style: none;
    }
    :root {
      --primaria: #658161;
      --secundaria: #8da58d;
      --fundo-claro: #e8f0e8;
      --texto-principal: #000000;
      --texto-claro: #ffffff;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: rgba(232, 240, 232, 0.7);
      backdrop-filter: blur(5px);
      position: fixed;
      width: 100%;
      z-index: 9999;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    .menu-btn {
      display: none;
      font-size: 28px;
      cursor: pointer;
      margin-left: auto;
    }
    .logo img {
      height: 50px;
      object-fit: cover;
    }
    nav.menu {
      margin-left: auto;
      flex-shrink: 0;
    }
    nav.menu ul {
      display: flex;
      gap: 20px;
      flex-wrap: nowrap;
    }
    nav.menu ul li a {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      color: var(--primaria);
      transition: color 0.3s ease;
      white-space: nowrap;
    }
    nav.menu ul li a:hover {
      color: var(--secundaria);
    }

    .cta-header {
      margin-left: 20px;
      flex-shrink: 0;
    }
    .cta-header button {
      background-color: var(--primaria);
      color: var(--texto-claro);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .cta-header button:hover {
      background-color: var(--secundaria);
    }

    .donate-float-mobile {
      display: none;
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999999;
      background-color: var(--primaria);
      color: var(--texto-claro);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .donate-float-mobile:hover {
      background-color: var(--secundaria);
    }

    .lang-switch {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: 15px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      flex-shrink: 0;
      z-index: 999999;
    }
    .lang-switch a {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      color: var(--primaria);
      text-decoration: none;
    }
    .lang-switch a img {
      width: 20px;
      height: 20px;
      object-fit: cover;
      border-radius: 2px;
    }
    .lang-switch a.inactive {
      filter: grayscale(100%);
      opacity: 0.5;
    }
    .lang-switch a:hover {
      background-color: var(--fundo-claro);
    }

    /* HERO (tela cheia + parallax) */
    #hero {
      position: relative;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      height: 100vh; /* ocupa toda a tela */
      text-align: center;
      overflow: hidden;
      color: #fff;
      margin-top: 70px; /* para n√£o ficar atr√°s do header fixo */
      background: url("imagens/fundoimpacto.png") center center / cover no-repeat;
      background-attachment: fixed; /* efeito parallax */
    }
    #hero .hero-text {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 600px;
      padding: 20px;
      margin: 0 auto;
    }
    #hero .hero-text h1 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      margin-bottom: 15px;
      font-size: 2rem;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
    }
    #hero .hero-text p {
      margin-bottom: 20px;
      font-size: 1.1rem;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 10px 20px;
      border-radius: 8px;
    }

    /* CONTE√öDO DA HIST√ìRIA */
    .historia-container {
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background: transparent; /* total transpar√™ncia */
      border-radius: 0;
      box-shadow: none;        /* sem sombra */
    }
    .historia-container img {
      max-width: 100%;
      border-radius: 8px;
      margin: 20px auto;
      display: block; /* garante centraliza√ß√£o */
    }
    /* T√≠tulo principal do texto */
    .titulo-historia {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: #b2916c; /* mesma cor do texto */
      margin-bottom: 20px;
      font-size: 1.8rem;
      text-align: center;
    }
    /* Vers√≠culo (texto) e refer√™ncia */
    .versiculo-historia {
      font-style: italic;
      font-size: 1rem;
      color: #b2916c;
      text-align: center;
      margin: 10px 0 0 0; /* Margem acima e abaixo */
      white-space: pre-wrap; /* para exibir todo o conte√∫do */
    }
    .versiculo-referencia {
      font-weight: bold;
      color: #b2916c;
      text-align: center;
      margin: 5px 0 20px 0;
    }
    /* Texto da hist√≥ria */
    .texto-historia {
      margin-bottom: 20px;
      line-height: 1.6;
      text-align: justify;
      color: #b2916c;
      overflow-wrap: break-word;
      word-wrap: break-word;
      hyphens: auto;
      white-space: normal;
      text-indent: 2em; /* afastamento da margem na primeira linha */
    }
    .botoes-acao {
      display: flex;
      gap: 10px;
      margin-bottom: 40px;
      justify-content: center;
    }
    .botoes-acao button, .botoes-acao a {
      background-color: var(--primaria);
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      text-decoration: none;
    }
    .botoes-acao button:hover, .botoes-acao a:hover {
      background-color: var(--secundaria);
    }

    footer {
      background-color: var(--primaria);
      color: var(--texto-claro);
      text-align: center;
      padding: 20px;
      margin-top: 40px;
      padding-bottom: 100px;
    }
    footer p {
      margin-bottom: 10px;
      font-size: 0.95rem;
    }
    footer .social-media a {
      color: var(--texto-claro);
      margin: 0 10px;
      transition: color 0.3s ease;
    }
    footer .social-media a:hover {
      color: var(--secundaria);
    }

    /* RESPONSIVIDADE */
    @media (max-width: 768px) {
      header {
        flex-wrap: nowrap;
        overflow-x: auto;
      }
      .menu-btn {
        display: block;
        margin-left: 10px;
      }
      nav.menu ul {
        display: none;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
      }
      .cta-header {
        display: none;
      }
      .donate-float-mobile {
        display: block;
      }
      .titulo-historia {
        font-size: 1.8rem;
        font-weight: bold;
        color: #b2916c;
        text-align: center;
        margin-bottom: 20px;
      }
    }
    @media (max-width: 480px) {
      html {
        font-size: 14px;
      }
      .titulo-historia {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <img src="imagens/logo.png" alt="Logotipo Funda√ß√£o Hannah" />
  </div>

  <div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
  <nav class="menu">
    <ul>
      <li><a href="index.html" id="nav-inicio">In√≠cio</a></li>
      <li><a href="impacto.html" id="nav-historias-impacto">Hist√≥rias</a></li>
      <!-- Voc√™ pode adicionar os outros links se quiser manter id√™ntico ao original -->
    </ul>
  </nav>

  <div class="cta-header">
    <button onclick="window.location.href='https://hannahenglishcourse.vercel.app/Carrossel/doe.html'">Doe Agora</button>
  </div>

  <div class="lang-switch">
    <a href="#" id="lang-pt" onclick="setLanguage('pt')">
      <img src="imagens/bandeira-pt.png" alt="PT" />
      PT
    </a>
    <a href="#" id="lang-en" onclick="setLanguage('en')" class="inactive">
      <img src="imagens/bandeira-en.png" alt="EN" />
      EN
    </a>
  </div>
</header>

<!-- Bot√£o flutuante (mobile) -->
<button class="donate-float-mobile" onclick="window.location.href='https://hannahenglishcourse.vercel.app/Carrossel/doe.html'">
  Doe Agora
</button>

<!-- HERO -->
<section id="hero">
  <div class="hero-text">
    <h1>Hist√≥ria Completa</h1>
    <p id="hero-subtitle">Acompanhe todos os detalhes desta hist√≥ria inspiradora.</p>
  </div>
</section>

<!-- CONTE√öDO DA HIST√ìRIA -->
<div class="historia-container">
  <img id="historia-img" src="imagens/placeholder.jpg" alt="Imagem da Hist√≥ria" />

  <h1 class="titulo-historia" id="titulo-historia">Carregando t√≠tulo...</h1>

  <!-- Vers√≠culo e refer√™ncia -->
  <div class="versiculo-historia" id="versiculo-historia"></div>
  <div class="versiculo-referencia" id="versiculo-numero"></div>

  <div class="texto-historia" id="texto-historia">Carregando texto completo...</div>

  <div class="botoes-acao">
    <button id="btn-compartilhar-historia">Compartilhe esta hist√≥ria</button>
    <a href="impacto.html" id="btn-voltar-lista">Voltar para Hist√≥rias</a>
  </div>
</div>

<!-- RODAP√â -->
<footer>
  <p>¬© 2025 Funda√ß√£o Hannah. Todos os direitos reservados.</p>
  <div class="social-media">
    <a href="https://facebook.com" target="_blank">Facebook</a> |
    <a href="https://instagram.com" target="_blank">Instagram</a> |
    <a href="https://youtube.com" target="_blank">YouTube</a>
  </div>
  <p>Endere√ßo: 106/18 moo 13 Piyaporn , Mae Sai District, Chiang Rai Province -Thailand - 57130 | E-mail: thailandhannahfoundation@gmail.com | WhatsApp: +66622634630</p>
</footer>

<script>
  /* MENU MOBILE */
  function toggleMenu() {
    const menuUl = document.querySelector('nav.menu ul');
    if (menuUl.style.display === 'flex') {
      menuUl.style.display = 'none';
    } else {
      menuUl.style.display = 'flex';
    }
  }

  function setLanguage(lang) {
    changeLanguage(lang);
    if(lang === 'pt') {
      document.getElementById('lang-pt').classList.remove('inactive');
      document.getElementById('lang-en').classList.add('inactive');
    } else {
      document.getElementById('lang-pt').classList.add('inactive');
      document.getElementById('lang-en').classList.remove('inactive');
    }
  }

  const translations = {
    "nav-inicio": { pt: "In√≠cio", en: "Home" },
    "nav-historias-impacto": { pt: "Hist√≥rias", en: "Stories" },
    "btn-compartilhar-historia": { pt: "Compartilhe esta hist√≥ria", en: "Share this story" },
    "btn-voltar-lista": { pt: "Voltar para Hist√≥rias", en: "Back to Stories" },
    "hero-subtitle": {
      pt: "Acompanhe todos os detalhes desta hist√≥ria inspiradora.",
      en: "Explore the full details of this inspiring story."
    }
  };

  function changeLanguage(lang) {
    document.documentElement.setAttribute("lang", lang);
    for (let key in translations) {
      let el = document.getElementById(key);
      if (el) el.innerHTML = translations[key][lang];
    }
    // Depois de mudar o lang, recarregue a hist√≥ria
    if(historiaId) {
      carregarHistoria(historiaId);
    }
  }

  /* PEGAR ?id= e ?lang= da URL */
  function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
  }
  const historiaId = getQueryParam("id");
  const langParam = getQueryParam("lang") || "pt";

  /* FUN√á√ÉO PARA CARREGAR BLOCO COMPLETO (PT/EN) */
  async function carregarHistoria(id) {
    try {
      const url = `impacto/${id}/historia.txt`;
      const resp = await fetch(url);
      const text = await resp.text();
      const lang = document.documentElement.getAttribute("lang") || "pt";

      // Separa blocos # PT e # EN
      const [ptBlock, enBlock] = separarBlocos(text);

      const dataPT = parseBlocoLongo(ptBlock);
      const dataEN = parseBlocoLongo(enBlock);

      if(lang === 'pt') {
        document.getElementById('titulo-historia').innerText = dataPT.titulo || "Sem T√≠tulo (PT)";
        document.getElementById('texto-historia').innerText = dataPT.texto || "Sem texto (PT)";
        document.getElementById('historia-img').src = `impacto/${id}/${dataPT.imagem || 'placeholder.jpg'}`;
        document.getElementById('versiculo-historia').innerText = dataPT.versiculo || "";
        document.getElementById('versiculo-numero').innerText = dataPT.versiculoNumero || "";
      } else {
        document.getElementById('titulo-historia').innerText = dataEN.titulo || "No Title (EN)";
        document.getElementById('texto-historia').innerText = dataEN.texto || "No text (EN)";
        document.getElementById('historia-img').src = `impacto/${id}/${dataEN.imagem || 'placeholder.jpg'}`;
        document.getElementById('versiculo-historia').innerText = dataEN.versiculo || "";
        document.getElementById('versiculo-numero').innerText = dataEN.versiculoNumero || "";
      }
    } catch (err) {
      document.getElementById('titulo-historia').innerText = "Erro ao carregar hist√≥ria";
      console.error(err);
    }
  }

  function separarBlocos(conteudo) {
    let indicePt = conteudo.indexOf("# PT");
    let indiceEn = conteudo.indexOf("# EN");
    if(indicePt === -1) return ["",""];
    if(indiceEn === -1) indiceEn = conteudo.length;

    let ptBlock = conteudo.substring(indicePt, indiceEn);
    let enBlock = conteudo.substring(indiceEn);
    return [ptBlock, enBlock];
  }

  // Ajuste de parsing para n√£o cortar o vers√≠culo no primeiro ':' e incluir a refer√™ncia
  function parseBlocoLongo(bloco) {
    let data = { titulo: "", texto: "", imagem: "", versiculo: "", versiculoNumero: "" };
    let lines = bloco.split("\n");
    let isReadingText = false;

    for (let line of lines) {
      let trimmed = line.trim();

      // Ignora marcadores de bloco
      if(trimmed.startsWith("# PT") || trimmed.startsWith("# EN")) {
        continue;
      }

      if(trimmed.startsWith("T√çTULO:") || trimmed.startsWith("TITLE:")) {
        // Remove "T√çTULO:" ou "TITLE:" do in√≠cio e pega o resto
        data.titulo = trimmed.replace(/^T√çTULO:/i, "").replace(/^TITLE:/i, "").trim();
        isReadingText = false;

      } else if(trimmed.startsWith("TEXTO:") || trimmed.startsWith("TEXT:")) {
        // Inicia leitura de texto (multilinha)
        isReadingText = true;
        // Remove "TEXTO:" ou "TEXT:" e anexa no data.texto
        let partial = trimmed.replace(/^TEXTO:/i, "").replace(/^TEXT:/i, "").trim();
        data.texto += partial + "\n";

      } else if(trimmed.startsWith("IMAGEM:") || trimmed.startsWith("IMAGE:")) {
        data.imagem = trimmed.replace(/^IMAGEM:/i, "").replace(/^IMAGE:/i, "").trim();
        isReadingText = false;

      } else if(trimmed.startsWith("VERSICULO:") || trimmed.startsWith("VERSE:")) {
        // Verso inteiro (sem cortar no ':')
        data.versiculo = trimmed
          .replace(/^VERSICULO:/i, "")
          .replace(/^VERSE:/i, "")
          .trim();
        isReadingText = false;

      } else if(trimmed.startsWith("VERSICULONUMERO:") || trimmed.startsWith("VERSENUMBER:")) {
        data.versiculoNumero = trimmed
          .replace(/^VERSICULONUMERO:/i, "")
          .replace(/^VERSENUMBER:/i, "")
          .trim();
        isReadingText = false;

      } else {
        // Linha comum. Se estamos lendo texto, concatena no texto
        if(isReadingText) {
          data.texto += trimmed + "\n";
        }
      }
    }
    return data;
  }

  function shareThisStory() {
    const lang = document.documentElement.getAttribute("lang") || "pt";
    let shareTextPT = "Essa hist√≥ria me impactou e eu quis compartilhar com voc√™. Leia como Deus transformou essa vida! üôå‚ú®";
    let shareTextEN = "This story touched me deeply, and I wanted to share it with you. Read how God transformed this life! üôå‚ú®";
    const storyUrl = window.location.href;
    const finalText = (lang === 'pt') ? shareTextPT : shareTextEN;

    if (navigator.share) {
      navigator.share({
        title: document.title,
        text: finalText,
        url: storyUrl
      }).catch(console.error);
    } else {
      alert(finalText + "\n\n" + storyUrl);
    }
  }

  window.addEventListener("DOMContentLoaded", () => {
    // Ajusta idioma inicial de acordo com ?lang= na URL
    setLanguage(langParam);

    if(historiaId) {
      carregarHistoria(historiaId);
    }

    // Bot√£o compartilhar
    document.getElementById("btn-compartilhar-historia").addEventListener("click", shareThisStory);
  });
</script>
</body>
</html>
