<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#658161" />
  <title id="page-title">Fundação Hannah</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&family=Open+Sans:wght@300;400;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    /* RESET BÁSICO */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      overflow-x: hidden; /* Evita scroll horizontal */
    }

    html {
      font-size: 16px;
    }

    body {
      font-family: 'Open Sans', Arial, sans-serif;
      background-color: #ffffff;
      color: #000000;
      line-height: 1.6;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    ul {
      list-style: none;
    }

    /* CORES PRINCIPAIS */
    :root {
      --primaria: #658161;
      --secundaria: #8da58d;
      --fundo-claro: #e8f0e8;
      --texto-principal: #000000;
      --texto-claro: #ffffff;
    }

    /* HEADER (Menu fixo) */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: rgba(232, 240, 232, 0.7); /* Reduzindo a opacidade para maior transparência */
      backdrop-filter: blur(5px); /* Adiciona um leve desfoque para destacar o menu */
      position: fixed; /* Fixa o menu no topo para efeito contínuo */
      width: 100%; /* Garante que o menu ocupe a largura total */
      z-index: 9999; /* Mantém o menu acima de outros elementos */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Adiciona sombra para contraste */
    }

    .menu-btn {
      display: none; /* só aparece no mobile */
      font-size: 28px;
      cursor: pointer;
      margin-left: auto;
    }

    header .logo img {
      height: 50px;
      max-width: 100%;
      object-fit: cover;
    }

    nav.menu {
      margin-left: auto;
      flex-shrink: 0;
    }
    nav.menu ul {
      display: flex;
      gap: 20px;
      flex-wrap: nowrap;
    }
    nav.menu ul li a {
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      color: var(--primaria);
      transition: color 0.3s ease;
      white-space: nowrap;
    }
    nav.menu ul li a:hover {
      color: var(--secundaria);
    }

    /* BOTÃO DOE AGORA (desktop) */
    .cta-header {
      margin-left: 20px;
      flex-shrink: 0;
    }
    .cta-header button {
      background-color: var(--primaria);
      color: var(--texto-claro);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .cta-header button:hover {
      background-color: var(--secundaria);
    }

    /* BOTÃO DOE AGORA (mobile flutuante) */
    .donate-float-mobile {
      display: none;
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 999999;
      background-color: var(--primaria);
      color: var(--texto-claro);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    .donate-float-mobile:hover {
      background-color: var(--secundaria);
    }

    /* SELETOR DE IDIOMA (LADO A LADO) */
    .lang-switch {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-left: 15px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      flex-shrink: 0;
      z-index: 999999; /* bem alto */
    }
    .lang-switch a {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 5px 8px;
      border-radius: 6px;
      transition: background-color 0.2s ease;
      color: var(--primaria);
      text-decoration: none;
    }
    .lang-switch a img {
      width: 20px;
      height: 20px;
      object-fit: cover;
      border-radius: 2px;
    }
    .lang-switch a.inactive {
      filter: grayscale(100%);
      opacity: 0.5;
    }
    .lang-switch a:hover {
      background-color: var(--fundo-claro);
    }

    /* BANNER PARALLAX PARA "Histórias do Campo Missionário" */
    .banner-impacto {
      height: 100vh; /* ocupa toda a tela visível */
      background: url("imagens/impacto.png") center center / cover no-repeat fixed;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: #fff;
      position: relative;
      padding: 0 20px;
      margin-top: 0; /* sem gap */
    }
    .banner-impacto h1 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 15px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 8px;
    }
    .banner-impacto p {
      font-size: 1.1rem;
      max-width: 700px;
      background-color: rgba(0, 0, 0, 0.4);
      padding: 8px 15px;
      border-radius: 6px;
    }

    /* SEÇÃO HISTÓRIAS DINÂMICAS */
    .historias-dinamicas-section {
      padding: 40px 20px;
      background-color: #f2f2f2;
      text-align: center;
    }
    .historias-dinamicas-section h2 {
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      color: var(--primaria);
      margin-bottom: 20px;
      font-size: 2rem;
    }
    .historias-dinamicas-section p {
      max-width: 600px;
      margin: 0 auto 20px auto;
      color: #333;
    }
    .filtros-historias {
      margin-bottom: 20px;
    }
    .filtros-historias button {
      background-color: var(--primaria);
      color: #fff;
      border: none;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .filtros-historias button:hover {
      background-color: var(--secundaria);
    }
    .historias-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card-historia {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .card-historia img {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }
    .card-historia .conteudo {
      padding: 15px;
    }
    .card-historia h3 {
      color: var(--primaria);
      margin-bottom: 10px;
      font-size: 1.2rem;
      font-family: 'Montserrat', sans-serif;
    }
    .card-historia p {
      font-size: 0.95rem;
      margin-bottom: 15px;
    }
    .card-historia button {
      background-color: var(--primaria);
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .card-historia button:hover {
      background-color: var(--secundaria);
    }

    /* RODAPÉ (mesmo estilo) */
    footer {
      background-color: var(--primaria);
      color: var(--texto-claro);
      text-align: center;
      padding: 20px;
      margin-top: 40px;
      padding-bottom: 100px; /* Espaço extra para não cobrir o WhatsApp */
    }
    footer p {
      margin-bottom: 10px;
      font-size: 0.95rem;
    }
    footer .social-media a {
      color: var(--texto-claro);
      margin: 0 10px;
      transition: color 0.3s ease;
    }
    footer .social-media a:hover {
      color: var(--secundaria);
    }

    /* SPINNER DE CARREGAMENTO */
    #loading-spinner {
      display: none;
      text-align: center;
      margin: 20px;
    }
    /* Aqui apenas um spinner simples: */
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #ccc;
      border-top-color: var(--primaria);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* BOTÃO VER MAIS */
    #btn-ver-mais {
      display: none;
      background-color: var(--primaria);
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin: 20px auto;
      display: block;
    }
    #btn-ver-mais:hover {
      background-color: var(--secundaria);
    }

    /* RESPONSIVIDADE */
    @media (max-width: 768px) {
      html {
        font-size: 15px;
      }
      header {
        flex-wrap: nowrap;
        overflow-x: auto;
      }
      .menu-btn {
        display: block;
        margin-left: 10px;
      }
      nav.menu ul {
        display: none;
        flex-direction: column;
        gap: 10px;
        margin-top: 10px;
      }
      .cta-header {
        display: none;
      }
      .donate-float-mobile {
        display: block;
      }
      .banner-impacto {
        height: 60vh; /* reduz no mobile para evitar rolagem */
        background-attachment: scroll; /* fallback se fix não for suportado */
      }
      .banner-impacto h1 {
        font-size: 1.8rem;
      }
      .historias-dinamicas-section {
        padding: 20px 10px;
      }
    }

    @media (max-width: 480px) {
      html {
        font-size: 14px;
      }
      body {
        line-height: 1.4;
      }
      .banner-impacto h1 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <!-- CABEÇALHO (MENU) -->
  <header>
    <div class="logo">
      <img src="imagens/logo.gif" alt="Logotipo Fundação Hannah" />
    </div>
    <div class="menu-btn" onclick="toggleMenu()">☰</div>
    <nav class="menu">
      <ul>
        <!-- Cada link aponta para a página principal + âncora específica -->
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html" id="nav-home">Home</a></li>
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html#sobre-nos" id="nav-sobre-nos">Sobre Nós</a></li>
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html#projetos" id="nav-projetos">Projetos</a></li>
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html#como-ajudar" id="nav-como-ajudar">Como Ajudar</a></li>
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html#depoimentos" id="nav-depoimentos">Depoimentos</a></li>
        <li><a href="https://hannahenglishcourse.netlify.app/Carrossel/hannah.html#footer" id="nav-contato">Contato</a></li>
      </ul>
    </nav>
    <div class="cta-header">
      <button onclick="window.location.href='https://hannahenglishcourse.netlify.app/Carrossel/doe.html'">Doe Agora</button>
    </div>
    <!-- Seletor de idioma -->
    <div class="lang-switch">
      <a href="#" id="lang-pt" onclick="setLanguage('pt')">
        <img src="imagens/bandeira-pt.png" alt="PT" />
        PT
      </a>
      <a href="#" id="lang-en" onclick="setLanguage('en')" class="inactive">
        <img src="imagens/bandeira-en.png" alt="EN" />
        EN
      </a>
    </div>
  </header>

  <!-- Botão Doe Agora (mobile) -->
  <button class="donate-float-mobile" onclick="window.location.href='https://hannahenglishcourse.netlify.app/Carrossel/doe.html'">
    Doe Agora
  </button>

  <!-- BANNER PARALLAX "Histórias do Campo Missionário" -->
  <section class="banner-impacto">
    <h1 id="banner-h1">Histórias do Campo Missionário</h1>
    <p id="banner-p">Conheça histórias reais de transformação</p>
  </section>

  <!-- SEÇÃO HISTÓRIAS (DINÂMICO) -->
  <section class="historias-dinamicas-section" id="historias-dinamicas">
    <!-- Botão para Compartilhar Esta Página -->
    <button id="btn-compartilhar-pagina" style="margin-bottom: 20px;">
      Compartilhe esta página
    </button>

    <!-- Filtros -->
    <div class="filtros-historias">
      <!-- Observação: mudamos o texto para "Mais Recentes" -->
      <button id="filtro-todas">Mais Recentes</button>
      <button id="filtro-criancas">Crianças</button>
      <button id="filtro-familias">Famílias</button>
      <button id="filtro-missionarios">Missionários</button>
      <button id="filtro-refugiados">Refugiados</button>
      <button id="filtro-milagres">Milagres</button>
      <button id="filtro-educacao">Educação</button>
    </div>

    <!-- Spinner de Carregamento -->
    <div id="loading-spinner">
      <div class="spinner"></div>
      <p>Carregando...</p>
    </div>

    <!-- Grade de Histórias -->
    <div class="historias-grid" id="historias-grid">
      <!-- Cartões gerados dinamicamente via JS -->
    </div>

    <!-- Botão Ver Mais -->
    <button id="btn-ver-mais">Ver mais</button>
  </section>

  <!-- RODAPÉ (mesmo estilo) -->
  <footer>
    <p>© 2025 Hannah Mission. All rights reserved.</p>
    <div class="social-media">
      <a href="https://facebook.com" target="_blank">Facebook</a> |
      <a href="https://instagram.com" target="_blank">Instagram</a> |
      <a href="https://youtube.com" target="_blank">YouTube</a>
    </div>
    <p>Endereço: Thailand | E-mail: magdalenoroquette@gmail.com | WhatsApp: +66622634630</p>
  </footer>

  <script>
    /* MENU MOBILE */
    function toggleMenu() {
      const menuUl = document.querySelector('nav.menu ul');
      if (menuUl.style.display === 'flex') {
        menuUl.style.display = 'none';
      } else {
        menuUl.style.display = 'flex';
      }
    }

    /* SELETOR DE IDIOMA */
    function setLanguage(lang) {
      changeLanguage(lang);
      if (lang === 'pt') {
        document.getElementById('lang-pt').classList.remove('inactive');
        document.getElementById('lang-en').classList.add('inactive');
      } else {
        document.getElementById('lang-pt').classList.add('inactive');
        document.getElementById('lang-en').classList.remove('inactive');
      }
    }

    /* TRADUÇÕES (PT <-> EN) */
    const translations = {
      "page-title": {
        pt: "Fundação Hannah",
        en: "Hannah Foundation"
      },
      "banner-h1": {
        pt: "Histórias do Campo Missionário",
        en: "Mission Field Stories"
      },
      "banner-p": {
        pt: "Conheça histórias reais de transformação.",
        en: "Discover real-life stories of transformation."
      },
      "btn-compartilhar-pagina": {
        pt: "Compartilhe esta página",
        en: "Share this page"
      },
      // Filtro "todas" agora se chama "Mais Recentes"
      "filtro-todas": {
        pt: "Mais Recentes",
        en: "Most Recent"
      },
      "filtro-criancas": {
        pt: "Crianças",
        en: "Children"
      },
      "filtro-familias": {
        pt: "Famílias",
        en: "Families"
      },
      "filtro-missionarios": {
        pt: "Missionários",
        en: "Missionaries"
      },
      "filtro-refugiados": {
        pt: "Refugiados",
        en: "Refugees"
      },
      "filtro-milagres": {
        pt: "Milagres",
        en: "Miracles"
      },
      "filtro-educacao": {
        pt: "Educação",
        en: "Education"
      }
    };

    function changeLanguage(lang) {
      document.documentElement.setAttribute("lang", lang);
      for (let key in translations) {
        const element = document.getElementById(key);
        if (element) {
          element.innerHTML = translations[key][lang];
        }
      }
      // Re-renderizar as histórias com o novo idioma:
      mostrarHistorias(filtroAtual, false); 
    }

    // -------------- LÓGICA PRINCIPAL -------------- //

    // Variáveis globais
    let metadadosGlobal = [];   // todas as histórias encontradas
    let storiesPerPage = 5;     // número de cards por página
    let currentPage = 1;        // página atual
    let filteredStories = [];   // histórias filtradas
    let filtroAtual = 'todas';  // guarda categoria atual (para re-render se mudar idioma)

    // Para detectar pasta: historia1, historia2...
    const maxPastas = 50;

    // 1) Carrega TODAS as pastas
    async function carregarTodasHistorias() {
      const encontradas = [];
      for (let i = 1; i <= maxPastas; i++) {
        const pasta = `historia${i}`;
        // Tenta buscar o arquivo
        const url = `impacto/${pasta}/historia.txt`;
        try {
          const resp = await fetch(url);
          if (!resp.ok) {
            continue; // pasta não existe ou 404
          }
          const fullText = await resp.text();
          const info = parseMetadados(fullText);
          // Armazena também o 'numero da pasta' para ordenação
          info.folderNumber = i;

          // IMPORTANTE: no card, usaremos a PASTA 'historiaX',
          // então guardamos info.folderPath = pasta
          info.folderPath = pasta;

          encontradas.push(info);
        } catch (e) {
          // se erro, ignora
        }
      }
      return encontradas;
    }

    // 2) Extrai metadados do .txt
    function parseMetadados(fullText) {
      let info = {
        id: "",
        categorias: [],
        imagemLista: "",
        tituloPT: "",
        resumoPT: "",
        tituloEN: "",
        resumoEN: ""
      };
      const lines = fullText.split("\n");
      for (let line of lines) {
        const trimmed = line.trim();
        // Se chegou em "# PT", paramos. 
        // (Ou se preferir, você pode continuar lendo, mas normalmente # PT marca o início do texto longo.)
        if (trimmed.startsWith("# PT")) break;

        if (trimmed.startsWith("ID:")) {
          info.id = trimmed.replace("ID:", "").trim();
        } else if (trimmed.startsWith("CATEGORIAS:")) {
          let cats = trimmed.replace("CATEGORIAS:", "").trim();
          info.categorias = cats.split(",").map(c => c.trim());
        } else if (trimmed.startsWith("IMAGEM_LISTA:")) {
          info.imagemLista = trimmed.replace("IMAGEM_LISTA:", "").trim();
        } else if (trimmed.startsWith("TITULO_PT:")) {
          info.tituloPT = trimmed.replace("TITULO_PT:", "").trim();
        } else if (trimmed.startsWith("RESUMO_PT:")) {
          info.resumoPT = trimmed.replace("RESUMO_PT:", "").trim();
        } else if (trimmed.startsWith("TITULO_EN:")) {
          info.tituloEN = trimmed.replace("TITULO_EN:", "").trim();
        } else if (trimmed.startsWith("RESUMO_EN:")) {
          info.resumoEN = trimmed.replace("RESUMO_EN:", "").trim();
        }
      }
      return info;
    }

    // 3) Mostra as histórias, mas paginando (5 por vez)
    function mostrarHistorias(cat, resetPage = true) {
      // cat = categoria a filtrar
      filtroAtual = cat; // salva globalmente

      // se resetPage, então volta para a primeira página
      if (resetPage) {
        currentPage = 1;
      }

      // Filtra
      let lista;
      if (cat === 'todas') {
        // "Mais Recentes" => todas, mas ordem decrescente do folderNumber
        lista = [...metadadosGlobal].sort((a, b) => b.folderNumber - a.folderNumber);
      } else {
        // Filtra pela categoria e depois ordena
        lista = metadadosGlobal.filter(h => h.categorias.includes(cat));
        // Por padrão, vamos manter a mesma lógica de exibir do mais recente pro mais antigo
        lista.sort((a, b) => b.folderNumber - a.folderNumber);
      }

      filteredStories = lista;
      renderPage(); // exibe a página atual
    }

    // 4) Renderiza a página (parte da paginação)
    function renderPage() {
      const grid = document.getElementById("historias-grid");
      grid.innerHTML = "";

      // Pega o subset de historias de filteredStories
      const startIndex = (currentPage - 1) * storiesPerPage;
      const endIndex = currentPage * storiesPerPage;
      const subset = filteredStories.slice(startIndex, endIndex);

      // Idioma
      const lang = document.documentElement.getAttribute("lang") || "pt";

      // Gera os cards
      subset.forEach(h => {
        const titulo = (lang === 'pt') ? h.tituloPT : h.tituloEN;
        const resumo = (lang === 'pt') ? h.resumoPT : h.resumoEN;

        const card = document.createElement("div");
        card.className = "card-historia";
        // Em vez de h.id, usamos h.folderPath para garantir a pasta correta
        card.innerHTML =
          `<img src="impacto/${h.folderPath}/${h.imagemLista}" alt="${titulo}">
           <div class="conteudo">
             <h3>${titulo}</h3>
             <p>${resumo}</p>
             <button onclick="abrirHistoria('${h.folderPath}')">
               ${ (lang === 'pt') ? 'Leia Mais' : 'Read More' }
             </button>
           </div>`;
        grid.appendChild(card);
      });

      // Verifica se tem mais páginas
      const btnVerMais = document.getElementById("btn-ver-mais");
      if (endIndex < filteredStories.length) {
        // ainda tem mais pra mostrar
        btnVerMais.style.display = "block";
      } else {
        // não tem mais
        btnVerMais.style.display = "none";
      }
    }

    // 5) Ao clicar no "Ver mais"
    function verMais() {
      currentPage++;
      renderPage();
    }

    // Abre historia.html
    function abrirHistoria(historiaPasta) {
      const lang = document.documentElement.getAttribute("lang");
      // Ex: historia2 => "?id=historia2&lang=pt"
      window.location.href = `historia.html?id=${historiaPasta}&lang=${lang}`;
    }

    // Função para filtrar
    function filtrarHistorias(cat) {
      mostrarHistorias(cat);
    }

    // 6) Compartilhar a página
    function shareThisPage() {
      const lang = document.documentElement.getAttribute("lang") || "pt";
      const shareTextPT = "Essas histórias me impactaram profundamente e eu quis compartilhar com você. Leia e veja como Deus está transformando vidas! 🙌✨";
      const shareTextEN = "These stories had a profound impact on me, and I wanted to share them with you. Read and see how God is transforming lives! 🙌✨";

      const finalText = (lang === "pt") ? shareTextPT : shareTextEN;
      const pageUrl = window.location.href;

      if (navigator.share) {
        navigator.share({
          title: document.title,
          text: finalText,
          url: pageUrl
        }).catch(console.error);
      } else {
        alert(finalText + "\n\n" + pageUrl);
      }
    }

    // 7) Ao carregar a página
    document.addEventListener("DOMContentLoaded", async () => {
      // Inicialmente, mostra o spinner
      document.getElementById("loading-spinner").style.display = "block";

      // Inicia com PT
      document.documentElement.setAttribute("lang","pt");
      document.getElementById('lang-pt').classList.remove('inactive');
      document.getElementById('lang-en').classList.add('inactive');
      changeLanguage('pt');

      // Carrega as histórias
      metadadosGlobal = await carregarTodasHistorias();

      // Oculta o spinner após carregar
      document.getElementById("loading-spinner").style.display = "none";

      // Exibe "Mais Recentes" (todas) por padrão
      mostrarHistorias('todas');

      // Eventos de filtro
      document.getElementById('filtro-todas').addEventListener('click', () => filtrarHistorias('todas'));
      document.getElementById('filtro-criancas').addEventListener('click', () => filtrarHistorias('criancas'));
      document.getElementById('filtro-familias').addEventListener('click', () => filtrarHistorias('familias'));
      document.getElementById('filtro-missionarios').addEventListener('click', () => filtrarHistorias('missionarios'));
      document.getElementById('filtro-refugiados').addEventListener('click', () => filtrarHistorias('refugiados'));
      document.getElementById('filtro-milagres').addEventListener('click', () => filtrarHistorias('milagres'));
      document.getElementById('filtro-educacao').addEventListener('click', () => filtrarHistorias('educacao'));

      // Botão compartilhar
      document.getElementById('btn-compartilhar-pagina').addEventListener('click', shareThisPage);

      // Botão ver mais
      document.getElementById('btn-ver-mais').addEventListener('click', verMais);
    });
  </script>
</body>
</html>
