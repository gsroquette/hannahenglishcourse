<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Login</title>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-analytics.js"></script>
</head>
<body>
    <div id="login-box" style="text-align: center;">
        <h2>Login with Phone</h2>
        <input type="text" id="phoneNumber" placeholder="Phone Number">
        <br><br>
        <button id="sendCode">Send Code</button>
        <br><br>
        <input type="text" id="verificationCode" placeholder="Verification Code">
        <br><br>
        <button id="verifyCode">Verify Code</button>
        <br><br>
        <!-- Contêiner para o reCAPTCHA -->
        <div id="recaptcha-container"></div>
    </div>

    <script>
        // Configurações do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDGgo2H_hDKXF88xN7XnLFNUj8ikMY7Xdc",
            authDomain: "hannahenglishcourse.firebaseapp.com",
            projectId: "hannahenglishcourse",
            storageBucket: "hannahenglishcourse.appspot.com",
            messagingSenderId: "449818788486",
            appId: "1:449818788486:web:8a49d3f68591e6fb3f0707",
            measurementId: "G-07VVJG9LRS"
        };

        // Inicializando o Firebase
        firebase.initializeApp(firebaseConfig);

        // Configurando reCAPTCHA
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
            'size': 'normal', // 'normal' para exibir o reCAPTCHA visível
            'callback': (response) => {
                // reCAPTCHA resolvido
                console.log('reCAPTCHA resolvido');
            },
            'expired-callback': () => {
                console.log('reCAPTCHA expirado');
            }
        });

        // Renderizando o reCAPTCHA
        recaptchaVerifier.render().then(function(widgetId) {
            window.recaptchaWidgetId = widgetId;
        });

        // Função para enviar código SMS
        document.getElementById('sendCode').addEventListener('click', function () {
            var phoneNumber = document.getElementById('phoneNumber').value;
            var appVerifier = window.recaptchaVerifier;

            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then(function (confirmationResult) {
                    // Código SMS enviado
                    window.confirmationResult = confirmationResult;
                    alert('Código de verificação enviado!');
                }).catch(function (error) {
                    console.error('Erro ao enviar código:', error);
                    alert('Erro ao enviar o código de verificação: ' + error.message);
                });
        });

        // Função para verificar código
        document.getElementById('verifyCode').addEventListener('click', function () {
            var code = document.getElementById('verificationCode').value;
            confirmationResult.confirm(code).then(function (result) {
                var user = result.user;
                alert('Código verificado, login bem-sucedido!');
                console.log('Login bem-sucedido:', user);
            }).catch(function (error) {
                console.error('Erro ao verificar código:', error);
                alert('Erro ao verificar o código: ' + error.message);
            });
        });
    </script>
</body>
</html>
