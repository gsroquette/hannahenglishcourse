<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hannah Fine Motor Skills Activities</title>
  <style>
    /* =====================
       THEME & TOKENS
    ===================== */
    :root{
      --bg: #f7f9fc;
      --surface: #ffffff;
      --brand: #3d7bfd;        /* soft indigo/blue */
      --brand-2: #76c7c0;       /* mint */
      --ink: #0f172a;           /* slate-900 */
      --muted: #64748b;         /* slate-500 */
      --ring: rgba(61,123,253,.35);
      --radius: 14px;
      --shadow: 0 10px 25px rgba(2,12,27,.08);
      --shadow-sm: 0 6px 16px rgba(2,12,27,.06);

      --container: 1040px;
      --space-1: 6px;
      --space-2: 10px;
      --space-3: 14px;
      --space-4: 18px;
      --space-5: 24px;
      --space-6: 32px;

      --dot-font-size: 48px;
      --word-font-size: 36px;
    }

    /* Fonte pontilhada local */
    @font-face {
      font-family: 'KGPrimaryDots';
      src: url('kg_primary_dots/KGPrimaryDots.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    /* Resetinho suave */
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #f9fbff 0%, var(--bg) 100%);
      color: var(--ink);
    }

    /* =====================
       HEADER
    ===================== */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      max-width: var(--container);
      margin: 10px auto 0;
      padding: 0 var(--space-5);
    }
    .back-btn{
      appearance: none;
      background: var(--surface);
      color: var(--ink);
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .back-btn:hover{ box-shadow: var(--shadow); }
    .back-btn:active{ transform: translateY(1px); }

    .hero{
      max-width: var(--container);
      margin: 18px auto 10px;
      padding: 0 var(--space-5);
    }
    .hero-card{
      background: radial-gradient(1200px 300px at 10% 0%, rgba(118,199,192,.18), transparent 60%) ,
                 radial-gradient(1200px 300px at 90% 0%, rgba(61,123,253,.18), transparent 60%),
                 var(--surface);
      border: 1px solid #e6edf7;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: var(--space-6);
      display: grid; grid-template-columns: 80px 1fr; gap: var(--space-4);
      align-items: center;
    }
    .hero-card img{ width:80px; height:auto; filter: drop-shadow(0 6px 10px rgba(61,123,253,.15)); }
    .hero-title{ margin:0; font-size: clamp(24px, 4vw, 36px); line-height:1.15; }
    .hero-sub{ margin:.35rem 0 0; color: var(--muted); font-size: 15px; }

    /* =====================
       PANELS / LAYOUT
    ===================== */
    .container{ max-width: var(--container); margin: 0 auto; padding: 0 var(--space-5) var(--space-6); }

    .grid{
      display: grid; gap: var(--space-5);
      grid-template-columns: 320px 1fr;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .panel{
      background: var(--surface);
      border: 1px solid #e6edf7;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      padding: var(--space-5);
    }
    .panel h2{ margin:0 0 10px; font-size: 18px; letter-spacing:.2px; }
    .muted{ color: var(--muted); font-size: 14px; margin-top: 4px; }

    /* Controls */
    .inputs{
      display: grid; gap: var(--space-3);
    }
    label{ font-size: 13px; color: var(--muted); display:block; margin-bottom: 6px; }
    .input{ width:100%; padding: 12px 12px; border:1px solid #e2e8f0; border-radius: 10px; font-size: 15px; background:#fff; }
    .input:focus{ outline: none; box-shadow: 0 0 0 4px var(--ring); border-color: #cbd5e1; }

    .actions{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 6px; }
    .btn{
      background: linear-gradient(180deg, var(--brand) 0%, #2b63ea 100%);
      color:#fff; border:none; border-radius: 10px; padding: 12px 16px; font-size: 15px; cursor:pointer;
      box-shadow: 0 8px 20px rgba(61,123,253,.25);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .btn:hover{ box-shadow: 0 10px 24px rgba(61,123,253,.35); }
    .btn:active{ transform: translateY(1px); }
    .btn-secondary{
      background: linear-gradient(180deg, #10b981 0%, #059669 100%);
      box-shadow: 0 8px 20px rgba(16,185,129,.25);
    }

    /* =====================
       ACTIVITIES LIST
    ===================== */
    .activities-wrap{ display:flex; flex-direction:column; gap: var(--space-4); }

    .line{
      position: relative;
      display: grid; grid-template-columns: 160px 1fr; gap: var(--space-4);
      align-items: center;
      padding: var(--space-4);
      background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
      border: 1px solid #e6edf7;
      border-radius: 16px;
      box-shadow: var(--shadow-sm);
      page-break-inside: avoid; /* evita quebra no PDF */
    }
    @media (max-width: 640px){ .line{ grid-template-columns: 1fr; } }

    .image-preview{ width: 150px; height: auto; border-radius: 10px; box-shadow: 0 6px 16px rgba(2,12,27,.06); }

    .remove-btn{
      position: absolute; top: 10px; right: 10px;
      width: 32px; height: 32px; border-radius: 50%;
      border: none; cursor: pointer;
      background: #ef4444; color:#fff; font-weight:700;
      box-shadow: 0 8px 18px rgba(239,68,68,.25);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .remove-btn:hover{ box-shadow: 0 10px 20px rgba(239,68,68,.35); }
    .remove-btn:active{ transform: translateY(1px); }

    .word{ font-size: var(--word-font-size); font-weight: 700; margin-right: 12px; display:inline-block; }
    .dotted-text{ font-family: 'KGPrimaryDots', Arial, sans-serif; font-size: var(--dot-font-size); letter-spacing: 3px; line-height: 1.3; display:inline-block; vertical-align: middle; white-space: normal; }

    .hidden{ display:none !important; }
    .no-print{ display: initial; }

    /* PRINT (PDF) */
    @media print{
      .no-print, .remove-btn{ display:none !important; }
      body{ -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .line{ break-inside: avoid; page-break-inside: avoid; }
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <button class="back-btn no-print" onclick="window.location.href='../index.html'">← Back</button>
    <span class="muted no-print">Hannah Tools</span>
  </div>

  <!-- Hero / Header -->
  <section class="hero">
    <div class="hero-card">
      <img src="Logo.png" alt="Logo" loading="lazy"/>
      <div>
        <h1 class="hero-title">Hannah Fine Motor Skills Activities</h1>
        <p class="hero-sub">Create dotted handwriting lines from any word + optional image. Clean print layout, kid‑friendly typography.</p>
      </div>
    </div>
  </section>

  <main class="container">
    <div class="grid">
      <!-- Controls Panel -->
      <aside class="panel no-print">
        <h2>Create activity</h2>
        <p class="muted">Add an image (optional), the target word and how many repetitions you want to print in dotted style.</p>
        <div class="inputs">
          <div>
            <label for="imageInput">Image (optional)</label>
            <input class="input" type="file" id="imageInput" accept="image/*" />
          </div>
          <div>
            <label for="wordInput">Word</label>
            <input class="input" type="text" id="wordInput" placeholder="Type the word..." />
          </div>
          <div>
            <label for="repeatInput">Repetitions</label>
            <input class="input" type="number" id="repeatInput" placeholder="Number of repetitions..." />
          </div>
        </div>
        <div class="actions" style="margin-top:12px;">
          <button id="addBtn" class="btn" onclick="addActivity()">Add Activity</button>
          <button id="pdfBtn" class="btn btn-secondary">Generate PDF</button>
        </div>
      </aside>

      <!-- Activities -->
      <section class="panel">
        <h2 style="margin-bottom:12px;">Activities</h2>
        <div id="activities" class="activities-wrap"></div>
      </section>
    </div>
  </main>

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

  <script>
    function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }

    function addActivity(){
      const file = document.getElementById('imageInput').files[0];
      const word = (document.getElementById('wordInput').value || '').trim();
      const repeatRaw = document.getElementById('repeatInput').value;
      const repeat = clamp(parseInt(repeatRaw || '1', 10), 1, 25);

      if(!word){ alert('Please enter a word.'); return; }
      if(isNaN(repeat)){ alert('Please enter a valid number of repetitions.'); return; }

      const container = document.getElementById('activities');
      const line = document.createElement('div');
      line.className = 'line';

      // remover
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn no-print';
      removeBtn.textContent = '×';
      removeBtn.title = 'Remove';
      removeBtn.onclick = () => container.removeChild(line);
      line.appendChild(removeBtn);

      // imagem opcional
      if(file){
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result; img.alt = 'Activity image';
          img.className = 'image-preview';
          line.appendChild(img);
          appendWordAndDottedText(line, word, repeat);
        };
        reader.readAsDataURL(file);
      } else {
        appendWordAndDottedText(line, word, repeat);
      }

      container.appendChild(line);

      // limpar
      document.getElementById('wordInput').value = '';
      document.getElementById('repeatInput').value = '';
      document.getElementById('imageInput').value = '';
    }

    function appendWordAndDottedText(line, word, repeat){
      const wrap = document.createElement('div');
      wrap.style.display = 'inline-block';

      const wordSpan = document.createElement('span');
      wordSpan.className = 'word';
      wordSpan.textContent = word;

      const dotted = document.createElement('span');
      dotted.className = 'dotted-text';

      for(let i=0;i<repeat;i++){
        const span = document.createElement('span');
        span.textContent = word + (i < repeat-1 ? ' ' : '');
        dotted.appendChild(span);
      }

      wrap.appendChild(wordSpan);
      wrap.appendChild(dotted);
      line.appendChild(wrap);
    }

    async function generatePDFPrintOnly(){
      if(typeof html2pdf === 'undefined'){
        alert('PDF engine failed to load. Check your internet connection to Cloudflare CDN.');
        return;
      }
      
      const lines = document.querySelectorAll('#activities .line');
      if(!lines.length){ 
        alert('Add at least one activity before generating the PDF.'); 
        return; 
      }

      // Build a clean, print-only document with enhanced layout
      const printRoot = document.createElement('div');
      printRoot.id = 'print-root';
      printRoot.style.background = '#ffffff';
      printRoot.style.padding = '15mm 10mm';
      printRoot.style.fontFamily = 'system-ui, -apple-system, sans-serif';

      // Enhanced Header with better styling
      const header = document.createElement('div');
      header.style.display = 'flex';
      header.style.alignItems = 'center';
      header.style.justifyContent = 'space-between';
      header.style.marginBottom = '20px';
      header.style.paddingBottom = '15px';
      header.style.borderBottom = '2px solid #f1f5f9';

      const logoContainer = document.createElement('div');
      logoContainer.style.display = 'flex';
      logoContainer.style.alignItems = 'center';
      logoContainer.style.gap = '15px';

      const logo = document.createElement('img');
      logo.src = 'Logo.png';
      logo.alt = 'Logo';
      logo.style.width = '70px';
      logo.style.height = 'auto';
      logo.style.filter = 'drop-shadow(0 4px 8px rgba(61,123,253,.2))';

      const titleContainer = document.createElement('div');
      const title = document.createElement('h1');
      title.textContent = 'Fine Motor Skills Activities';
      title.style.margin = '0';
      title.style.fontSize = '24px';
      title.style.color = '#1e293b';
      title.style.fontWeight = '700';

      const subtitle = document.createElement('p');
      subtitle.textContent = 'Handwriting Practice Sheets';
      subtitle.style.margin = '4px 0 0 0';
      subtitle.style.fontSize = '14px';
      subtitle.style.color = '#64748b';

      titleContainer.appendChild(title);
      titleContainer.appendChild(subtitle);
      logoContainer.appendChild(logo);
      logoContainer.appendChild(titleContainer);
      header.appendChild(logoContainer);

      const nameDateWrap = document.createElement('div');
      nameDateWrap.style.textAlign = 'right';
      nameDateWrap.style.minWidth = '250px';
      
      const nameLine = document.createElement('div');
      nameLine.textContent = 'Name: _________________________________________';
      nameLine.style.fontSize = '14px';
      nameLine.style.marginBottom = '8px';
      nameLine.style.color = '#475569';

      const dateLine = document.createElement('div');
      dateLine.textContent = 'Date: _____________';
      dateLine.style.fontSize = '14px';
      dateLine.style.color = '#475569';

      nameDateWrap.appendChild(nameLine);
      nameDateWrap.appendChild(dateLine);
      header.appendChild(nameDateWrap);

      printRoot.appendChild(header);

      // Activities with enhanced layout
      const activitiesContainer = document.createElement('div');
      activitiesContainer.style.display = 'flex';
      activitiesContainer.style.flexDirection = 'column';
      activitiesContainer.style.gap = '25px';

      lines.forEach((srcLine, index) => {
        const printLine = document.createElement('div');
        printLine.style.display = 'grid';
        printLine.style.gridTemplateColumns = '140px 1fr';
        printLine.style.gap = '20px';
        printLine.style.alignItems = 'start';
        printLine.style.padding = '20px';
        printLine.style.backgroundColor = '#f8fafc';
        printLine.style.borderRadius = '12px';
        printLine.style.border = '1px solid #e2e8f0';
        printLine.style.pageBreakInside = 'avoid';
        printLine.style.breakInside = 'avoid';

        // Activity number
        const activityNumber = document.createElement('div');
        activityNumber.style.gridColumn = '1 / -1';
        activityNumber.style.fontSize = '12px';
        activityNumber.style.color = '#94a3b8';
        activityNumber.style.fontWeight = '600';
        activityNumber.style.marginBottom = '10px';
        activityNumber.textContent = `Activity ${index + 1}`;
        printLine.appendChild(activityNumber);

        // Image (optional) with enhanced styling
        const img = srcLine.querySelector('img.image-preview');
        if(img){
          const imageContainer = document.createElement('div');
          imageContainer.style.display = 'flex';
          imageContainer.style.flexDirection = 'column';
          imageContainer.style.alignItems = 'center';
          imageContainer.style.gap = '8px';

          const cloneImg = document.createElement('img');
          cloneImg.src = img.src;
          cloneImg.alt = 'Activity image';
          cloneImg.style.width = '120px';
          cloneImg.style.height = 'auto';
          cloneImg.style.borderRadius = '8px';
          cloneImg.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
          cloneImg.style.border = '2px solid #ffffff';

          const imageLabel = document.createElement('div');
          imageLabel.textContent = 'Trace the word:';
          imageLabel.style.fontSize = '12px';
          imageLabel.style.color = '#64748b';
          imageLabel.style.fontWeight = '500';

          imageContainer.appendChild(cloneImg);
          imageContainer.appendChild(imageLabel);
          printLine.appendChild(imageContainer);
        } else {
          const spacer = document.createElement('div');
          spacer.style.width = '120px';
          spacer.style.height = '1px';
          printLine.appendChild(spacer);
        }

        // Text content with enhanced styling
        const textWrap = document.createElement('div');
        textWrap.style.display = 'flex';
        textWrap.style.flexDirection = 'column';
        textWrap.style.gap = '12px';

        const word = (srcLine.querySelector('.word')?.textContent || '').trim();

        // Word title with guidance line
        const wordSection = document.createElement('div');
        wordSection.style.marginBottom = '8px';

        const wordTitle = document.createElement('div');
        wordTitle.textContent = word;
        wordTitle.style.fontSize = '32px';
        wordTitle.style.fontWeight = '700';
        wordTitle.style.color = '#1e293b';
        wordTitle.style.marginBottom = '4px';
        wordTitle.style.letterSpacing = '0.5px';

        const guidanceLine = document.createElement('div');
        guidanceLine.style.width = '100%';
        guidanceLine.style.height = '2px';
        guidanceLine.style.background = 'linear-gradient(90deg, #3d7bfd 0%, transparent 100%)';
        guidanceLine.style.marginBottom = '12px';

        wordSection.appendChild(wordTitle);
        wordSection.appendChild(guidanceLine);

        // Dotted text with better spacing
        const dottedContainer = document.createElement('div');
        dottedContainer.style.padding = '15px 0';
        dottedContainer.style.borderTop = '1px dashed #e2e8f0';

        const dotted = document.createElement('div');
        dotted.style.fontFamily = '\'KGPrimaryDots\', Arial, sans-serif';
        dotted.style.fontSize = '42px';
        dotted.style.letterSpacing = '2px';
        dotted.style.lineHeight = '1.4';
        dotted.style.color = '#334155';
        dotted.style.minHeight = '60px';

        const dottedSource = srcLine.querySelector('.dotted-text');
        if(dottedSource){
          dotted.innerHTML = dottedSource.innerHTML;
        } else if(word){
          dotted.textContent = word + ' ';
        }

        // Practice line at the bottom
        const practiceLine = document.createElement('div');
        practiceLine.style.marginTop = '20px';
        practiceLine.style.paddingTop = '15px';
        practiceLine.style.borderTop = '1px dashed #e2e8f0';

        const practiceLabel = document.createElement('div');
        practiceLabel.textContent = 'Now practice on your own:';
        practiceLabel.style.fontSize = '12px';
        practiceLabel.style.color = '#64748b';
        practiceLabel.style.marginBottom = '8px';
        practiceLabel.style.fontWeight = '500';

        const blankLine = document.createElement('div');
        blankLine.style.width = '100%';
        blankLine.style.height = '2px';
        blankLine.style.background = 'repeating-linear-gradient(90deg, #cbd5e1 0px, #cbd5e1 4px, transparent 4px, transparent 8px)';
        blankLine.style.marginTop = '8px';

        practiceLine.appendChild(practiceLabel);
        practiceLine.appendChild(blankLine);

        dottedContainer.appendChild(dotted);
        textWrap.appendChild(wordSection);
        textWrap.appendChild(dottedContainer);
        textWrap.appendChild(practiceLine);
        printLine.appendChild(textWrap);

        activitiesContainer.appendChild(printLine);
      });

      printRoot.appendChild(activitiesContainer);

      // Footer
      const footer = document.createElement('div');
      footer.style.marginTop = '25px';
      footer.style.paddingTop = '15px';
      footer.style.borderTop = '1px solid #e2e8f0';
      footer.style.textAlign = 'center';
      footer.style.fontSize = '11px';
      footer.style.color = '#94a3b8';

      const footerText = document.createElement('div');
      footerText.textContent = 'Generated by Hannah Fine Motor Skills Tools • Practice makes perfect!';
      footer.appendChild(footerText);

      printRoot.appendChild(footer);

      document.body.appendChild(printRoot);

      const opt = {
        filename: 'Hannah_Fine_Motor_Skills_Activities.pdf',
        margin: [10, 10, 15, 10],
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] },
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { 
          scale: 3, 
          useCORS: true, 
          letterRendering: true,
          backgroundColor: '#ffffff'
        },
        jsPDF: { 
          unit: 'mm', 
          format: 'a4', 
          orientation: 'portrait', 
          compress: true,
          hotfixes: ["px_scaling"]
        }
      };

      try{
        // Wait for fonts and images to load
        if(document.fonts && document.fonts.ready){ 
          await document.fonts.ready; 
        }
        
        // Wait for images to load
        const images = printRoot.querySelectorAll('img');
        await Promise.all(Array.from(images).map(img => {
          if(img.complete) return Promise.resolve();
          return new Promise(resolve => {
            img.onload = resolve;
            img.onerror = resolve;
            setTimeout(resolve, 1000); // Fallback timeout
          });
        }));

        // Small delay to ensure everything is rendered
        await new Promise(resolve => setTimeout(resolve, 500));

        await html2pdf().from(printRoot).set(opt).save();
      } catch(err){
        console.error('PDF Generation Error:', err);
        alert('There was an error generating the PDF. Please try again.');
      } finally {
        printRoot.remove();
      }
    }

    // Initialize event listeners when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      const pdfBtn = document.getElementById('pdfBtn');
      if(pdfBtn) {
        pdfBtn.addEventListener('click', generatePDFPrintOnly);
      }
    });
  </script>
</body>
</html>