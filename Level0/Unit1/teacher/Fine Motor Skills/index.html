<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hannah Fine Motor Skills Activities</title>
  <style>
    /* =====================
       THEME & TOKENS
    ===================== */
    :root{
      --bg: #f7f9fc;
      --surface: #ffffff;
      --brand: #3d7bfd;        /* soft indigo/blue */
      --brand-2: #76c7c0;       /* mint */
      --ink: #0f172a;           /* slate-900 */
      --muted: #64748b;         /* slate-500 */
      --ring: rgba(61,123,253,.35);
      --radius: 14px;
      --shadow: 0 10px 25px rgba(2,12,27,.08);
      --shadow-sm: 0 6px 16px rgba(2,12,27,.06);

      --container: 1040px;
      --space-1: 6px;
      --space-2: 10px;
      --space-3: 14px;
      --space-4: 18px;
      --space-5: 24px;
      --space-6: 32px;

      --dot-font-size: 48px;
      --word-font-size: 36px;
    }

    /* Fonte pontilhada local */
    @font-face {
      font-family: 'KGPrimaryDots';
      src: url('kg_primary_dots/KGPrimaryDots.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    /* Resetinho suave */
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(180deg, #f9fbff 0%, var(--bg) 100%);
      color: var(--ink);
    }

    /* =====================
       HEADER
    ===================== */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      max-width: var(--container);
      margin: 10px auto 0;
      padding: 0 var(--space-5);
    }
    .back-btn{
      appearance: none;
      background: var(--surface);
      color: var(--ink);
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 15px;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .back-btn:hover{ box-shadow: var(--shadow); }
    .back-btn:active{ transform: translateY(1px); }

    .hero{
      max-width: var(--container);
      margin: 18px auto 10px;
      padding: 0 var(--space-5);
    }
    .hero-card{
      background: radial-gradient(1200px 300px at 10% 0%, rgba(118,199,192,.18), transparent 60%) ,
                 radial-gradient(1200px 300px at 90% 0%, rgba(61,123,253,.18), transparent 60%),
                 var(--surface);
      border: 1px solid #e6edf7;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: var(--space-6);
      display: grid; grid-template-columns: 80px 1fr; gap: var(--space-4);
      align-items: center;
    }
    .hero-card img{ width:80px; height:auto; filter: drop-shadow(0 6px 10px rgba(61,123,253,.15)); }
    .hero-title{ margin:0; font-size: clamp(24px, 4vw, 36px); line-height:1.15; }
    .hero-sub{ margin:.35rem 0 0; color: var(--muted); font-size: 15px; }

    /* =====================
       PANELS / LAYOUT
    ===================== */
    .container{ max-width: var(--container); margin: 0 auto; padding: 0 var(--space-5) var(--space-6); }

    .grid{
      display: grid; gap: var(--space-5);
      grid-template-columns: 320px 1fr;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns: 1fr; } }

    .panel{
      background: var(--surface);
      border: 1px solid #e6edf7;
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      padding: var(--space-5);
    }
    .panel h2{ margin:0 0 10px; font-size: 18px; letter-spacing:.2px; }
    .muted{ color: var(--muted); font-size: 14px; margin-top: 4px; }

    /* Controls */
    .inputs{
      display: grid; gap: var(--space-3);
    }
    label{ font-size: 13px; color: var(--muted); display:block; margin-bottom: 6px; }
    .input{ width:100%; padding: 12px 12px; border:1px solid #e2e8f0; border-radius: 10px; font-size: 15px; background:#fff; }
    .input:focus{ outline: none; box-shadow: 0 0 0 4px var(--ring); border-color: #cbd5e1; }

    .actions{ display:flex; gap: 10px; flex-wrap: wrap; margin-top: 6px; }
    .btn{
      background: linear-gradient(180deg, var(--brand) 0%, #2b63ea 100%);
      color:#fff; border:none; border-radius: 10px; padding: 12px 16px; font-size: 15px; cursor:pointer;
      box-shadow: 0 8px 20px rgba(61,123,253,.25);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .btn:hover{ box-shadow: 0 10px 24px rgba(61,123,253,.35); }
    .btn:active{ transform: translateY(1px); }
    .btn-secondary{
      background: linear-gradient(180deg, #10b981 0%, #059669 100%);
      box-shadow: 0 8px 20px rgba(16,185,129,.25);
    }

    /* =====================
       ACTIVITIES LIST
    ===================== */
    .activities-wrap{ display:flex; flex-direction:column; gap: var(--space-4); }

    .line{
      position: relative;
      display: grid; grid-template-columns: 160px 1fr; gap: var(--space-4);
      align-items: center;
      padding: var(--space-4);
      background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
      border: 1px solid #e6edf7;
      border-radius: 16px;
      box-shadow: var(--shadow-sm);
      page-break-inside: avoid; /* evita quebra no PDF */
    }
    @media (max-width: 640px){ .line{ grid-template-columns: 1fr; } }

    .image-preview{ width: 150px; height: auto; border-radius: 10px; box-shadow: 0 6px 16px rgba(2,12,27,.06); }

    .remove-btn{
      position: absolute; top: 10px; right: 10px;
      width: 32px; height: 32px; border-radius: 50%;
      border: none; cursor: pointer;
      background: #ef4444; color:#fff; font-weight:700;
      box-shadow: 0 8px 18px rgba(239,68,68,.25);
      transition: transform .08s ease, box-shadow .2s ease;
    }
    .remove-btn:hover{ box-shadow: 0 10px 20px rgba(239,68,68,.35); }
    .remove-btn:active{ transform: translateY(1px); }

    .word{ font-size: var(--word-font-size); font-weight: 700; margin-right: 12px; display:inline-block; }
    .dotted-text{ font-family: 'KGPrimaryDots', Arial, sans-serif; font-size: var(--dot-font-size); letter-spacing: 3px; line-height: 1.3; display:inline-block; vertical-align: middle; white-space: normal; }

    .hidden{ display:none !important; }
    .no-print{ display: initial; }

    /* PRINT (PDF) */
    @media print{
      .no-print, .remove-btn{ display:none !important; }
      body{ -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
      .line{ break-inside: avoid; page-break-inside: avoid; }
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <button class="back-btn no-print" onclick="window.location.href='../index.html'">← Back</button>
    <span class="muted no-print">Hannah Tools</span>
  </div>

  <!-- Hero / Header -->
  <section class="hero">
    <div class="hero-card">
      <img src="Logo.png" alt="Logo" loading="lazy"/>
      <div>
        <h1 class="hero-title">Hannah Fine Motor Skills Activities</h1>
        <p class="hero-sub">Create dotted handwriting lines from any word + optional image. Clean print layout, kid‑friendly typography.</p>
      </div>
    </div>
  </section>

  <main class="container">
    <div class="grid">
      <!-- Controls Panel -->
      <aside class="panel no-print">
        <h2>Create activity</h2>
        <p class="muted">Add an image (optional), the target word and how many repetitions you want to print in dotted style.</p>
        <div class="inputs">
          <div>
            <label for="imageInput">Image (optional)</label>
            <input class="input" type="file" id="imageInput" accept="image/*" />
          </div>
          <div>
            <label for="wordInput">Word</label>
            <input class="input" type="text" id="wordInput" placeholder="Type the word..." />
          </div>
          <div>
            <label for="repeatInput">Repetitions</label>
            <input class="input" type="number" id="repeatInput" placeholder="Number of repetitions..." />
          </div>
        </div>
        <div class="actions" style="margin-top:12px;">
          <button id="addBtn" class="btn" onclick="addActivity()">Add Activity</button>
          <button id="pdfBtn" class="btn btn-secondary" onclick="generatePDFPrintOnly()">Generate PDF</button>
        </div>
      </aside>

      <!-- Activities -->
      <section class="panel">
        <h2 style="margin-bottom:12px;">Activities</h2>
        <div id="activities" class="activities-wrap"></div>
      </section>
    </div>
  </main>

  <!-- html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js">
    function generatePDFPrintOnly(){
      // Build a clean, print-only document: Logo + Name/Date + Activities
      const printRoot = document.createElement('div');
      printRoot.id = 'print-root';
      printRoot.style.background = '#ffffff';
      printRoot.style.padding = '8mm';

      // Header (Logo + Name/Date)
      const header = document.createElement('div');
      header.style.display = 'flex';
      header.style.alignItems = 'center';
      header.style.gap = '12px';
      header.style.marginBottom = '12px';

      const logo = document.createElement('img');
      logo.src = 'Logo.png';
      logo.alt = 'Logo';
      logo.style.width = '80px';
      logo.style.height = 'auto';
      header.appendChild(logo);

      const nameDateWrap = document.createElement('div');
      nameDateWrap.style.marginLeft = 'auto';
      nameDateWrap.style.fontSize = '14px';
      nameDateWrap.textContent = 'Name: _________________________________________   Date: _____________';
      header.appendChild(nameDateWrap);

      printRoot.appendChild(header);

      // Activities -> clone each line into a print-friendly row
      const lines = document.querySelectorAll('#activities .line');
      lines.forEach((srcLine)=>{
        const printLine = document.createElement('div');
        printLine.style.display = 'grid';
        printLine.style.gridTemplateColumns = '150px 1fr';
        printLine.style.gap = '12px';
        printLine.style.alignItems = 'center';
        printLine.style.margin = '10px 0';
        printLine.style.pageBreakInside = 'avoid';

        // Image (optional)
        const img = srcLine.querySelector('img.image-preview');
        if(img){
          const cloneImg = document.createElement('img');
          cloneImg.src = img.src;
          cloneImg.alt = 'Activity image';
          cloneImg.style.width = '150px';
          cloneImg.style.height = 'auto';
          printLine.appendChild(cloneImg);
        } else {
          const spacer = document.createElement('div');
          spacer.style.width = '150px';
          spacer.style.height = '1px';
          printLine.appendChild(spacer);
        }

        // Text (Word + Dotted repetitions)
        const textWrap = document.createElement('div');
        const word = (srcLine.querySelector('.word')?.textContent || '').trim();

        const wordTitle = document.createElement('div');
        wordTitle.textContent = word;
        wordTitle.style.fontSize = '36px';
        wordTitle.style.fontWeight = '700';
        wordTitle.style.marginBottom = '4px';
        textWrap.appendChild(wordTitle);

        const dotted = document.createElement('div');
        dotted.style.fontFamily = '\'KGPrimaryDots\', Arial, sans-serif';
        dotted.style.fontSize = '48px';
        dotted.style.letterSpacing = '3px';
        dotted.style.lineHeight = '1.3';

        const dottedSource = srcLine.querySelector('.dotted-text');
        if(dottedSource){
          // clone dotted content (spans) so it prints exactly like on screen
          dotted.innerHTML = dottedSource.innerHTML;
        } else if(word){
          dotted.textContent = word + ' ';
        }

        textWrap.appendChild(dotted);
        printLine.appendChild(textWrap);
        printRoot.appendChild(printLine);
      });

      document.body.appendChild(printRoot);

      const opt = {
        filename: 'Hannah_Fine_Motor_Skills.pdf',
        margin: [8,8,12,8],
        pagebreak: { mode: ['avoid-all','css','legacy'] },
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, letterRendering: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait', compress: true }
      };

      (async ()=>{
        try{
          if(document.fonts && document.fonts.ready){ await document.fonts.ready; }
          await html2pdf().from(printRoot).set(opt).save();
        } catch(err){
          console.error(err);
          alert('There was an error generating the PDF. Please try again.');
        } finally {
          printRoot.remove();
        }
      })();
    }
  
  // --- Ensure the PDF button is wired correctly even if inline onclick fails ---
  document.addEventListener('DOMContentLoaded', ()=>{
    const btn = document.getElementById('pdfBtn');
    if(btn){
      try{ btn.onclick = null; }catch(e){}
      btn.addEventListener('click', generatePDFPrintOnly);
    }
  });
</script>

  <script>
    function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }

    function addActivity(){
      const file = document.getElementById('imageInput').files[0];
      const word = (document.getElementById('wordInput').value || '').trim();
      const repeatRaw = document.getElementById('repeatInput').value;
      const repeat = clamp(parseInt(repeatRaw || '1', 10), 1, 25);

      if(!word){ alert('Please enter a word.'); return; }
      if(isNaN(repeat)){ alert('Please enter a valid number of repetitions.'); return; }

      const container = document.getElementById('activities');
      const line = document.createElement('div');
      line.className = 'line';

      // remover
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn no-print';
      removeBtn.textContent = '×';
      removeBtn.title = 'Remove';
      removeBtn.onclick = () => container.removeChild(line);
      line.appendChild(removeBtn);

      // imagem opcional
      if(file){
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result; img.alt = 'Activity image';
          img.className = 'image-preview';
          line.appendChild(img);
          appendWordAndDottedText(line, word, repeat);
        };
        reader.readAsDataURL(file);
      } else {
        appendWordAndDottedText(line, word, repeat);
      }

      container.appendChild(line);

      // limpar
      document.getElementById('wordInput').value = '';
      document.getElementById('repeatInput').value = '';
      document.getElementById('imageInput').value = '';
    }

    function appendWordAndDottedText(line, word, repeat){
      const wrap = document.createElement('div');
      wrap.style.display = 'inline-block';

      const wordSpan = document.createElement('span');
      wordSpan.className = 'word';
      wordSpan.textContent = word;

      const dotted = document.createElement('span');
      dotted.className = 'dotted-text';

      for(let i=0;i<repeat;i++){
        const span = document.createElement('span');
        span.textContent = word + (i < repeat-1 ? ' ' : '');
        dotted.appendChild(span);
      }

      wrap.appendChild(wordSpan);
      wrap.appendChild(dotted);
      line.appendChild(wrap);
    }

    async function generatePDF(){
      const toHide = [
        ...document.querySelectorAll('.remove-btn'),
        document.getElementById('imageInput'),
        document.getElementById('wordInput'),
        document.getElementById('repeatInput'),
        document.getElementById('addBtn'),
        document.getElementById('pdfBtn'),
        ...document.querySelectorAll('.back-btn')
      ].filter(Boolean);
      toHide.forEach(el => el.classList.add('hidden'));

      // Name/Date
      const nameDate = document.createElement('div');
      nameDate.textContent = 'Name: _________________________________________   Date: _____________';
      nameDate.style.margin = '8px 0 14px';
      const hero = document.querySelector('.hero');
      hero.after(nameDate);

      try{
        if(document.fonts && document.fonts.ready){ await document.fonts.ready; }
        const element = document.body;
        const opt = {
          filename: 'Hannah_Fine_Motor_Skills.pdf',
          margin: [8,8,12,8],
          pagebreak: { mode: ['avoid-all','css','legacy'] },
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2, useCORS: true, letterRendering: true },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait', compress: true }
        };
        await html2pdf().from(element).set(opt).save();
      } catch(err){
        console.error(err); alert('There was an error generating the PDF. Please try again.');
      } finally {
        toHide.forEach(el => el.classList.remove('hidden'));
        if(nameDate && nameDate.parentNode){ nameDate.parentNode.removeChild(nameDate); }
      }
    }
  </script>
<script>
(function(){
  // Failsafe re-bind & safe redefinition without touching earlier blocks
  const domReady = () => new Promise((resolve)=>{
    if(document.readyState !== 'loading') return resolve();
    document.addEventListener('DOMContentLoaded', resolve, { once:true });
  });
  const clamp = (val, min, max) => Math.max(min, Math.min(max, val));

  // If addActivity is missing, (re)define minimal version compatible with current DOM
  if(typeof window.addActivity !== 'function'){
    window.addActivity = function(){
      const file = document.getElementById('imageInput').files[0];
      const word = (document.getElementById('wordInput').value || '').trim();
      const repeatRaw = document.getElementById('repeatInput').value;
      const repeat = clamp(parseInt(repeatRaw || '1', 10), 1, 25);
      if(!word){ alert('Please enter a word.'); return; }
      if(isNaN(repeat)){ alert('Please enter a valid number of repetitions.'); return; }
      const container = document.getElementById('activities');
      const line = document.createElement('div');
      line.className = 'line';
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn no-print';
      removeBtn.textContent = '×';
      removeBtn.onclick = () => container.removeChild(line);
      line.appendChild(removeBtn);
      const appendWordAndDottedText = (line, word, repeat)=>{
        const wrap = document.createElement('div');
        wrap.style.display = 'inline-block';
        const wordSpan = document.createElement('span');
        wordSpan.className = 'word';
        wordSpan.textContent = word;
        const dotted = document.createElement('span');
        dotted.className = 'dotted-text';
        for(let i=0;i<repeat;i++){
          const span = document.createElement('span');
          span.textContent = word + (i < repeat-1 ? ' ' : '');
          dotted.appendChild(span);
        }
        wrap.appendChild(wordSpan);
        wrap.appendChild(dotted);
        line.appendChild(wrap);
      };
      if(file){
        const reader = new FileReader();
        reader.onload = (e)=>{ const img = document.createElement('img'); img.src = e.target.result; img.className = 'image-preview'; line.appendChild(img); appendWordAndDottedText(line, word, repeat); };
        reader.readAsDataURL(file);
      } else {
        appendWordAndDottedText(line, word, repeat);
      }
      container.appendChild(line);
      document.getElementById('wordInput').value = '';
      document.getElementById('repeatInput').value = '';
      document.getElementById('imageInput').value = '';
    }
  }

  async function waitForFonts(ms=3000){
    if(!(document.fonts && document.fonts.ready)) return;
    const timer = new Promise(r=>setTimeout(r, ms));
    try { await Promise.race([document.fonts.ready, timer]); } catch(_){}
  }

  window.generatePDFPrintOnly = async function(){
    if(typeof html2pdf === 'undefined'){
      alert('PDF engine failed to load. Check your internet connection to Cloudflare CDN.');
      return;
    }
    const lines = document.querySelectorAll('#activities .line');
    if(!lines.length){ alert('Add at least one activity before generating the PDF.'); return; }

    const printRoot = document.createElement('div');
    printRoot.id = 'print-root';
    printRoot.style.background = '#ffffff';
    printRoot.style.padding = '8mm';

    const header = document.createElement('div');
    header.style.display = 'flex'; header.style.alignItems = 'center'; header.style.gap = '12px'; header.style.marginBottom = '12px';
    const logo = document.createElement('img'); logo.src = 'Logo.png'; logo.alt = 'Logo'; logo.style.width = '80px'; header.appendChild(logo);
    const nameDateWrap = document.createElement('div'); nameDateWrap.style.marginLeft = 'auto'; nameDateWrap.style.fontSize = '14px'; nameDateWrap.textContent = 'Name: _________________________________________   Date: _____________'; header.appendChild(nameDateWrap);
    printRoot.appendChild(header);

    lines.forEach((srcLine)=>{
      const printLine = document.createElement('div');
      printLine.style.display = 'grid'; printLine.style.gridTemplateColumns = '150px 1fr'; printLine.style.gap = '12px'; printLine.style.alignItems = 'center'; printLine.style.margin = '10px 0'; printLine.style.pageBreakInside = 'avoid';
      const img = srcLine.querySelector('img.image-preview');
      if(img){ const ci = document.createElement('img'); ci.src = img.src; ci.alt='Activity image'; ci.style.width='150px'; printLine.appendChild(ci);} else { const sp=document.createElement('div'); sp.style.width='150px'; sp.style.height='1px'; printLine.appendChild(sp);}    
      const textWrap = document.createElement('div');
      const word = (srcLine.querySelector('.word')?.textContent || '').trim();
      const wordTitle = document.createElement('div'); wordTitle.textContent = word; wordTitle.style.fontSize='36px'; wordTitle.style.fontWeight='700'; wordTitle.style.marginBottom='4px'; textWrap.appendChild(wordTitle);
      const dotted = document.createElement('div'); dotted.style.fontFamily = '\\'KGPrimaryDots\\', Arial, sans-serif'; dotted.style.fontSize = '48px'; dotted.style.letterSpacing='3px'; dotted.style.lineHeight='1.3';
      const dottedSource = srcLine.querySelector('.dotted-text');
      if(dottedSource){ dotted.innerHTML = dottedSource.innerHTML; } else if(word){ dotted.textContent = word + ' '; }
      textWrap.appendChild(dotted);
      printLine.appendChild(textWrap);
      printRoot.appendChild(printLine);
    });

    document.body.appendChild(printRoot);

    const opt = { filename:'Hannah_Fine_Motor_Skills.pdf', margin:[8,8,12,8], pagebreak:{ mode:['avoid-all','css','legacy'] }, image:{ type:'jpeg', quality:0.98 }, html2canvas:{ scale:2, useCORS:true, letterRendering:true }, jsPDF:{ unit:'mm', format:'a4', orientation:'portrait', compress:true } };

    try{ await waitForFonts(); await html2pdf().from(printRoot).set(opt).save(); } catch(err){ console.error(err); alert('There was an error generating the PDF. See console for details.'); } finally { printRoot.remove(); }
  }

  domReady().then(()=>{
    const btn = document.getElementById('pdfBtn');
    if(btn){
      btn.replaceWith(btn.cloneNode(true)); // remove stale listeners
      const fresh = document.getElementById('pdfBtn');
      fresh.addEventListener('click', window.generatePDFPrintOnly);
    }
  });
})();
</script>

</body>
</html>
