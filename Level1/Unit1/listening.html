<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hannah English Course</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase Configuration and Initialization -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDGgo2H_hDKXF88xN7XnLFNUj8ikMY7Xdc",
            authDomain: "hannahenglishcourse.firebaseapp.com",
            projectId: "hannahenglishcourse",
            storageBucket: "hannahenglishcourse.appspot.com",
            messagingSenderId: "449818788486",
            appId: "1:449818788486:web:8a49d3f68591e6fb3f0707",
            measurementId: "G-07VVJG9LRS",
            databaseURL: "https://hannahenglishcourse-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Function to unlock specific phases for students
        function unlockStudentPhases(phasesUnlocked) {
            const phases = document.querySelectorAll('.phase');
            phases.forEach((phase, index) => {
                if (index < phasesUnlocked) {
                    phase.classList.add('unlocked');
                    phase.disabled = false; // Enable phase button
                }
            });
        }

        // Function to unlock all phases
        function unlockAllPhases() {
            const phases = document.querySelectorAll('.phase');
            phases.forEach(phase => {
                phase.classList.add('unlocked');
                phase.disabled = false; // Enable phase button
            });
        }

        // Check user role and unlock phases accordingly
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                const userId = user.uid;
                const userRoleRef = firebase.database().ref(`/usuarios/${userId}/role`);
                const userProgressRef = firebase.database().ref(`/usuarios/${userId}/progresso`);

                // Get user role
                userRoleRef.once('value')
                    .then((snapshot) => {
                        const role = snapshot.val();
                        if (role === 'professor' || role === 'proprietario') {
                            // Unlock all phases if the user is a professor or owner
                            unlockAllPhases();
                        } else if (role === 'aluno') {
                            // Get user progress for students
                            userProgressRef.once('value')
                                .then((progressSnapshot) => {
                                    const progressData = progressSnapshot.val();
                                    if (progressData && progressData.lastPhaseUnlocked) {
                                        unlockStudentPhases(progressData.lastPhaseUnlocked);
                                    }
                                })
                                .catch((error) => {
                                    console.error('Error fetching user progress:', error);
                                });
                        }
                    })
                    .catch((error) => {
                        console.error('Error fetching user role:', error);
                    });
            }
        });
    </script>
</head>
<body>

    <!-- Botão Back -->
    <a href="javascript:history.back()" class="back-button">Back</a>

    <div class="map-container" id="mapContainer">
        <!-- Imagem de título centralizada sobre o fundo -->
        <div class="title-container">
            <img src="../../imagens/titulo.png" alt="Hannah English Course" class="title-image">
        </div>

        <!-- Fases (Exemplo) -->
        <div class="phase-container">
            <button class="phase locked" disabled>Phase 1</button>
            <button class="phase locked" disabled>Phase 2</button>
            <button class="phase locked" disabled>Phase 3</button>
            <!-- Adicione mais fases conforme necessário -->
        </div>

        <!-- SVG para as linhas -->
        <svg id="linesSvg" class="lines-svg"></svg>
    </div>

    <script src="script.js"></script>
</body>
</html>
