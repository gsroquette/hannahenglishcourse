<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hannah English Course</title>
    <link rel="stylesheet" href="style.css">
    <!-- Firebase Configuration and Initialization -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDGgo2H_hDKXF88xN7XnLFNUj8ikMY7Xdc",
            authDomain: "hannahenglishcourse.firebaseapp.com",
            projectId: "hannahenglishcourse",
            storageBucket: "hannahenglishcourse.appspot.com",
            messagingSenderId: "449818788486",
            appId: "1:449818788486:web:8a49d3f68591e6fb3f0707",
            measurementId: "G-07VVJG9LRS",
            databaseURL: "https://hannahenglishcourse-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Função para obter Level e Unit da URL
        function getLevelAndUnitFromURL() {
            const url = window.location.pathname; // Exemplo: "/Level1/Unit4/Flashcards/index.html"
            const parts = url.split('/'); // Divide a URL por "/"
            const level = parts[1]; // Obtém "Level1"
            const unit = parts[2]; // Obtém "Unit4"
            return { level, unit };
        }

        // Função para criar fase1 se não existir
        function createPhase1IfNotExists(userId) {
            const { level, unit } = getLevelAndUnitFromURL();
            const dbRef = firebase.database().ref(`usuarios/${userId}/progresso/${level}/${unit}/fase1`);

            // Verificar se a fase1 já existe
            dbRef.once('value')
                .then((snapshot) => {
                    if (!snapshot.exists()) {
                        // Se a fase1 não existir, criar e marcar como true
                        dbRef.set(true).then(() => {
                            console.log('Fase 1 criada com sucesso');
                        }).catch((error) => {
                            console.error('Erro ao criar fase 1:', error);
                        });
                    } else {
                        console.log('Fase 1 já existe');
                    }
                })
                .catch((error) => {
                    console.error('Erro ao verificar a fase 1:', error);
                });
        }

        // Função para garantir que o usuário esteja autenticado e criar fase1
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                // Usuário autenticado, verifica e cria a fase1 se necessário
                createPhase1IfNotExists(user.uid);
            } else {
                console.error('Usuário não autenticado');
            }
        });
    </script>
</head>
<body>

    <!-- Botão Back -->
    <a href="javascript:history.back()" class="back-button">Back</a>

    <div class="map-container" id="mapContainer">
        <!-- Imagem de título centralizada sobre o fundo -->
        <div class="title-container">
            <img src="../../imagens/titulo.png" alt="Hannah English Course" class="title-image">
        </div>

        <!-- SVG para as linhas -->
        <svg id="linesSvg" class="lines-svg"></svg>
    </div>

    <script src="script.js"></script>
</body>
</html>
