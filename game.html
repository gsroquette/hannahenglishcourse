<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Jogo de Palavras em Inglês</title>
  <style>
    /* ===== RESET BÁSICO ===== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      min-height: 100vh;
      background: #f0f0f0;
      font-family: Arial, sans-serif;
    }

    /* ===== CONTAINER GERAL ===== */
    #game-container {
      flex: 1;
      position: relative;
      padding: 20px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-start;
    }

    /* ===== SEÇÃO ESQUERDA: ROBÔ ===== */
    #robot-section {
      width: 150px;
      position: relative;
    }

    #robot-image {
      width: 100%;
      display: block;
      margin-bottom: 10px;
    }

    #robot-balloon {
      position: absolute;
      top: 0;
      left: 160px; /* deslocamento para o balão ficar à direita do robô */
      max-width: 250px;
      background: #fff;
      border: 2px solid #ccc;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
      display: none; /* ficará visível em certos momentos */
    }

    /* ===== SEÇÃO CENTRAL: JOGO ===== */
    #board-section {
      flex: 1;
      margin: 0 20px;
    }

    #difficulty-selection {
      margin-bottom: 10px;
    }

    #word-container {
      margin-bottom: 20px;
    }

    .attempt-row {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .letter-box {
      width: 40px;
      height: 40px;
      border: 1px solid #666;
      border-radius: 4px;
      margin-right: 5px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 18px;
      text-transform: uppercase;
    }

    .green {
      background-color: #4caf50;
      color: #fff;
    }

    .yellow {
      background-color: #ffeb3b;
      color: #000;
    }

    .red {
      background-color: #f44336;
      color: #fff;
    }

    .player-name {
      margin-left: 10px;
      font-size: 14px;
      color: #555;
    }

    /* ===== SEÇÃO DIREITA: PLACAR ===== */
    #scoreboard-section {
      width: 200px;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
    }

    #scoreboard-section h3 {
      margin-bottom: 10px;
      text-align: center;
    }

    #scoreboard-list {
      list-style: none;
    }

    #scoreboard-list li {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }

    /* ===== ESTILOS GERAIS ===== */
    .btn {
      display: inline-block;
      margin: 5px 0;
      padding: 8px 12px;
      border: none;
      background-color: #2196f3;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn:hover {
      background-color: #1e88e5;
    }

    #attempt-input {
      width: 200px;
      padding: 6px;
      margin-right: 5px;
    }
  </style>
</head>
<body>

<div id="game-container">
  
  <!-- Seção Esquerda: Robot Samuel -->
  <div id="robot-section">
    <img id="robot-image" src="imagens/robo_estatico.png" alt="Robot Samuel">
    <div id="robot-balloon"></div>
  </div>

  <!-- Seção Central: Jogo em si -->
  <div id="board-section">
    <div id="difficulty-selection">
      <label for="difficulty-select">Escolha a dificuldade:</label>
      <select id="difficulty-select">
        <option value="facil">Fácil</option>
        <option value="medio">Médio</option>
        <option value="dificil">Difícil</option>
      </select>
      <button class="btn" id="start-game">Iniciar Partida</button>
    </div>
    
    <div id="word-container">
      <!-- Aqui aparecem as linhas (tentativas) da "torre" de blocos -->
    </div>

    <div>
      <input type="text" id="attempt-input" placeholder="Tente uma palavra em inglês" />
      <button class="btn" id="try-button">Enviar Tentativa</button>
    </div>
  </div>

  <!-- Seção Direita: Placar -->
  <div id="scoreboard-section">
    <h3>Top 20 Players</h3>
    <ol id="scoreboard-list">
      <!-- Exemplo de dados estáticos -->
      <li>Maria - 250 pts</li>
      <li>João - 230 pts</li>
      <li>Sarah - 210 pts</li>
    </ol>
  </div>

</div>

<script>
  /********************************************************
   *           EXEMPLO DE DADOS E VARIÁVEIS GLOBAIS
   ********************************************************/
  // Exemplo de dicionários locais (palavras por dificuldade)
  // Em produção, você pode colocar milhares de palavras ou buscar no Firebase.
  const WORDS = {
    facil: ["apple", "banana", "table", "chair", "water"],
    medio: ["coffee", "purple", "orange", "banana", "answer"],
    dificil: ["software", "elephant", "mountain", "terrible", "question"]
  };

  // Frases motivacionais
  const motivationalPhrases = [
    "Almost there, NAME! Keep trying!",
    "Nice try, NAME! You're getting closer!",
    "Don't give up, NAME! You can do it!",
    "You're on the right track, NAME!",
    "Stay focused, NAME! You're doing great!"
  ];

  let chosenWord = "";       // Palavra que o usuário deve adivinhar
  let currentDifficulty = "facil";
  let userName = "";         // Nome do jogador atual (poderia vir do Firebase)
  let attemptsArray = [];    // Armazena todas as tentativas e seus resultados

  // Abaixo, definimos o Robot Samuel e sua fala
  const robotImage = document.getElementById("robot-image");
  const robotBalloon = document.getElementById("robot-balloon");
  const synth = window.speechSynthesis;

  /********************************************************
   *           FUNÇÃO DE SÍNTESE DE VOZ
   ********************************************************/
  function speakText(text) {
    if (!text) return;
    
    // Configurações da fala
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = "en-US"; // forçando inglês

    // Ao iniciar a fala...
    utterance.onstart = () => {
      // Trocar imagem do robô para o GIF
      robotImage.src = "imagens/robo_fala.gif";
      // Exibir balão com o texto
      robotBalloon.textContent = text;
      robotBalloon.style.display = "block";
    };

    // Ao terminar a fala...
    utterance.onend = () => {
      // Volta pra imagem estática
      robotImage.src = "imagens/robo_estatico.png";
      // Esconde o balão depois de um pequeno delay
      setTimeout(() => {
        robotBalloon.style.display = "none";
      }, 1000);
    };

    synth.speak(utterance);
  }

  /********************************************************
   *     FUNÇÃO PARA PEGAR DEFINIÇÃO NA FREE DICTIONARY API
   ********************************************************/
  async function getDefinition(word) {
    try {
      const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
      if (!response.ok) {
        throw new Error("Definição não encontrada");
      }
      const data = await response.json();
      // Pega a primeira definição encontrada
      const definition = data[0].meanings[0].definitions[0].definition;
      return definition;
    } catch (error) {
      console.error("Erro ao buscar definição:", error);
      return "";
    }
  }

  /********************************************************
   *              VALIDAÇÃO DE PALAVRA
   ********************************************************/
  // Exemplo simples: confere se a palavra existe em qualquer lista
  // (Idealmente, você teria uma lista grande ou validaria no servidor)
  function isValidWord(word) {
    const allWords = [...WORDS.facil, ...WORDS.medio, ...WORDS.dificil];
    return allWords.includes(word.toLowerCase());
  }

  /********************************************************
   *     FUNÇÃO PARA CALCULAR FEEDBACK DE CORES NA TENTATIVA
   ********************************************************/
  function getFeedbackForAttempt(attempt, actualWord) {
    // Converte tudo pra minúsculo, por garantia
    const attemptLetters = attempt.toLowerCase().split("");
    const actualLetters = actualWord.toLowerCase().split("");

    // Array pra armazenar as classes de cor (green, yellow, red)
    const feedback = [];

    // Primeiro, marca as letras green
    for (let i = 0; i < attemptLetters.length; i++) {
      if (attemptLetters[i] === actualLetters[i]) {
        feedback.push("green");
      } else {
        feedback.push("");
      }
    }

    // Agora, marca amarelo ou vermelho
    // (cuidando para não contar duplicatas)
    const letterCount = {};

    // Conta quantas vezes cada letra aparece na palavra real
    for (let char of actualLetters) {
      if (!letterCount[char]) letterCount[char] = 0;
      letterCount[char]++;
    }

    // Remove as letras já marcadas como verde do count
    for (let i = 0; i < attemptLetters.length; i++) {
      if (feedback[i] === "green") {
        letterCount[attemptLetters[i]]--;
      }
    }

    // Define amarelo ou vermelho
    for (let i = 0; i < attemptLetters.length; i++) {
      if (feedback[i] === "") {
        const letter = attemptLetters[i];
        if (letterCount[letter] && letterCount[letter] > 0) {
          feedback[i] = "yellow";
          letterCount[letter]--;
        } else {
          feedback[i] = "red";
        }
      }
    }

    return feedback;
  }

  /********************************************************
   *        FUNÇÃO PARA RENDERIZAR A TORRE DE TENTATIVAS
   ********************************************************/
  function renderAttempts() {
    const wordContainer = document.getElementById("word-container");
    wordContainer.innerHTML = ""; // limpa antes de renderizar novamente

    attemptsArray.forEach((attemptObj) => {
      const { attempt, feedback, player } = attemptObj;

      const rowDiv = document.createElement("div");
      rowDiv.classList.add("attempt-row");

      // Cria os bloquinhos de letra
      for (let i = 0; i < attempt.length; i++) {
        const letterBox = document.createElement("div");
        letterBox.classList.add("letter-box");
        letterBox.textContent = attempt[i].toUpperCase();
        if (feedback && feedback[i]) {
          letterBox.classList.add(feedback[i]);
        }
        rowDiv.appendChild(letterBox);
      }

      // Nome do jogador
      const playerSpan = document.createElement("span");
      playerSpan.classList.add("player-name");
      playerSpan.textContent = `- ${player}`;
      rowDiv.appendChild(playerSpan);

      wordContainer.appendChild(rowDiv);
    });
  }

  /********************************************************
   *        FUNÇÃO PARA INICIAR UMA NOVA PARTIDA
   ********************************************************/
  function startNewGame() {
    // Pergunta o nome do usuário (aqui simplificado, mas pode vir do Firebase)
    userName = prompt("Qual seu nome? (Ex: Maria)") || "Guest";

    // Seta a dificuldade
    const difficultySelect = document.getElementById("difficulty-select");
    currentDifficulty = difficultySelect.value;

    // Sorteia uma palavra
    const wordsArray = WORDS[currentDifficulty];
    chosenWord = wordsArray[Math.floor(Math.random() * wordsArray.length)];

    // Limpa as tentativas
    attemptsArray = [];
    renderAttempts();

    // Fala algo motivacional na abertura
    speakText(`Hello ${userName}, let's play! You chose ${currentDifficulty} level!`);
  }

  /********************************************************
   *       FUNÇÃO QUANDO O USUÁRIO ENVIA UMA TENTATIVA
   ********************************************************/
  async function handleAttempt() {
    const attemptInput = document.getElementById("attempt-input");
    let attempt = attemptInput.value.trim().toLowerCase();
    attemptInput.value = "";

    if (!attempt) return;
    
    // Verifica se a palavra é válida
    if (!isValidWord(attempt)) {
      speakText(`Sorry, ${userName}, this word is not valid in our dictionary.`);
      return;
    }

    // Calcula feedback (cores)
    const feedback = getFeedbackForAttempt(attempt, chosenWord);

    // Salva nos attempts
    attemptsArray.push({
      attempt: attempt,
      feedback,
      player: userName
    });

    // Renderiza novamente
    renderAttempts();

    // Verifica se acertou (todas letras verdes)
    const isAllGreen = feedback.every((color) => color === "green");
    if (isAllGreen) {
      // Usuário ganhou pontos (lógica de pontuação aqui)
      // Ex: easy: +10, medium: +20, hard: +30
      let points = 10;
      if (currentDifficulty === "medio") points = 20;
      if (currentDifficulty === "dificil") points = 30;

      // Busca definição
      const definition = await getDefinition(chosenWord);

      // Robot fala parabéns
      let message = `Congratulations ${userName}! The word is '${chosenWord}'.`;
      if (definition) {
        message += ` Definition: ${definition}`;
      }
      speakText(message);

      // Aqui você atualizaria o placar no Firebase
      // ...

      // Iniciar nova partida ou aguardar o usuário clicar
      // Exemplo simples: iniciar após 3s
      setTimeout(() => {
        startNewGame();
      }, 3000);

    } else {
      // Se não acertou, fala algo motivacional
      const randomIndex = Math.floor(Math.random() * motivationalPhrases.length);
      const phrase = motivationalPhrases[randomIndex].replace("NAME", userName);
      speakText(phrase);
    }
  }

  /********************************************************
   *           EVENTOS DE BOTÕES
   ********************************************************/
  document.getElementById("start-game").addEventListener("click", () => {
    startNewGame();
  });

  document.getElementById("try-button").addEventListener("click", () => {
    handleAttempt();
  });

  // Permitir pressionar Enter no campo de input
  document.getElementById("attempt-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      handleAttempt();
    }
  });
</script>

</body>
</html>
