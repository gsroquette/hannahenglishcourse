<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hannah Mixed Letters</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .form-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label, input, button {
            font-family: Arial, sans-serif;
            font-size: 16px;
        }

        input[type="text"], input[type="file"], input[type="checkbox"] {
            padding: 10px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        button {
            padding: 10px 20px;
            margin: 10px 0;
            border: none;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .activity-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <button onclick="window.location.href='../index.html'">Back</button>

    <h1>Hannah Mixed Letters</h1>

    <div class="form-container">
        <label>Upload Image (Optional): 
            <input type="file" id="image-upload" accept="image/*">
        </label>

        <label>Associated Word:
            <input type="text" id="word-input" placeholder="Enter the word here">
        </label>

        <div>
            <input type="checkbox" id="hide-word">
            <label for="hide-word">Hide full word</label>
        </div>

        <div>
            <button id="add-activity-btn">Add Activity</button>
            <button id="generate-pdf-btn">Generate PDF</button>
        </div>
    </div>

    <div id="activity-container" class="activity-container"></div>

    <script>
        function speakText(text) {
            const synth = window.speechSynthesis;
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.lang = 'en-US'; // Define o idioma para inglÃªs dos Estados Unidos
            synth.speak(utterThis);
        }

        let activities = [];

        function loadImageAsBase64(imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    resolve(event.target.result);
                };
                reader.onerror = function() {
                    reject('Error loading image.');
                };
                reader.readAsDataURL(imageFile);
            });
        }

        document.getElementById('add-activity-btn').addEventListener('click', async function() {
            const word = document.getElementById('word-input').value;
            const hideWord = document.getElementById('hide-word').checked;

            const imageInput = document.getElementById('image-upload');
            const imageFile = imageInput.files[0];

            let imageDataURL = null;
            if (imageFile) {
                imageDataURL = await loadImageAsBase64(imageFile);
            }

            const activityContainer = document.getElementById('activity-container');
            const activityDiv = document.createElement('div');

            const deleteButton = document.createElement('button');
            deleteButton.innerText = 'X';
            deleteButton.onclick = function() {
                const index = activities.indexOf(activity);
                if (index > -1) {
                    activities.splice(index, 1);
                }
                activityDiv.remove();
            };
            activityDiv.appendChild(deleteButton);

            const imageContainer = document.createElement('div');
            if (imageFile) {
                const imgElement = document.createElement('img');
                imgElement.src = URL.createObjectURL(imageFile);
                imageContainer.appendChild(imgElement);
            }
            activityDiv.appendChild(imageContainer);

            const wordContainer = document.createElement('div');

            const missingWordElement = document.createElement('div');

            const missingLetterInput = document.createElement('input');
            missingLetterInput.maxLength = 1;

            const letterAnimation = document.createElement('div');
            letterAnimation.innerText = word.charAt(0);
            activityDiv.appendChild(letterAnimation);

            missingLetterInput.addEventListener('input', function() {
                if (missingLetterInput.value.toUpperCase() === word.charAt(0).toUpperCase()) {
                    missingLetterInput.style.borderColor = 'blue';

                    speakText(missingLetterInput.value.toUpperCase());
                    setTimeout(() => {
                        speakText(word);
                    }, 1000);
                } else {
                    missingLetterInput.style.borderColor = 'red';
                }
            });

            missingWordElement.appendChild(missingLetterInput);

            const remainingWord = document.createElement('span');
            remainingWord.innerText = word.substring(1);
            missingWordElement.appendChild(remainingWord);
            wordContainer.appendChild(missingWordElement);

            if (!hideWord) {
                const fullWordElement = document.createElement('span');
                fullWordElement.innerText = word;
                wordContainer.appendChild(fullWordElement);
            }

            activityDiv.appendChild(wordContainer);
            activityContainer.appendChild(activityDiv);

            const activity = { word, hideWord, imageDataURL };
            activities.push(activity);

            document.getElementById('word-input').value = '';
            document.getElementById('image-upload').value = '';
            document.getElementById('hide-word').checked = false;
        });

        document.getElementById('generate-pdf-btn').addEventListener('click', async function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFontSize(22);
            doc.text('Hannah Mixed Letters', 20, 20);

            let yOffset = 40;

            const pdfPromises = activities.map(async (activity) => {
                if (activity.imageDataURL) {
                    doc.addImage(activity.imageDataURL, 'PNG', 10, yOffset, 40, 40);
                }

                doc.setFontSize(24);
                const missingWordText = "_ " + activity.word.substring(1);
                doc.text(missingWordText, 60, yOffset + 20);

                if (!activity.hideWord) {
                    doc.setFontSize(14);
                    doc.text(activity.word, 60, yOffset + 35);
                }

                yOffset += 60;
                if (yOffset > 270) {
                    doc.addPage();
                    yOffset = 20;
                }
            });

            await Promise.all(pdfPromises);

            doc.save('hannah-mixed-letters.pdf');
        });
    </script>
</body>
</html>
