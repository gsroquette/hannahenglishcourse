<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gerador de Prompt ‚Äî Autom√°tico (Netlify)</title>

<style>
:root{
  --bg:#0f172a; --card:#0b1022; --muted:#94a3b8; --text:#e2e8f0;
  --brand:#60a5fa; --ok:#22c55e; --bd:#1f2a44; --err:#ef4444;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:linear-gradient(180deg,#0b1022,#0f172a);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial
}
.wrap{max-width:1100px;margin:32px auto;padding:0 16px}
h1{font-weight:900;font-size:26px;margin:0 0 6px}
.sub{color:var(--muted);margin:0 0 18px}
.card{
  background:rgba(255,255,255,.03);
  border:1px solid var(--bd);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px
}
label{
  display:flex;
  justify-content:space-between;
  gap:10px;
  font-size:13px;
  color:#cbd5e1;
  margin-bottom:6px
}
input, select{
  width:100%;
  background:#0a0f1e;
  border:1px solid #1f2a44;
  border-radius:10px;
  color:var(--text);
  padding:10px;
  font-size:14px;
}
textarea{
  width:100%; background:#0a0f1e; border:1px solid #1f2a44; border-radius:10px;
  color:var(--text); padding:10px; font-size:14px; min-height:160px; line-height:1.45; resize:vertical
}
.small{min-height:140px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
button{
  appearance:none;
  border:none;
  background:linear-gradient(90deg,#3b82f6,#22c55e);
  color:white;
  font-weight:800;
  padding:12px 16px;
  border-radius:12px;
  cursor:pointer
}
button.ghost{
  background:transparent;
  border:1px solid var(--bd);
  color:#cbd5e1
}
.badge{font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<div class="wrap">

<h1>Gerador de Prompt ‚Äî Autom√°tico (Netlify)</h1>
<p class="sub">Carregue os dados, edite se quiser, e depois gere o prompt.</p>

<div class="card">

  <label>Base URL (Netlify)</label>
  <input id="baseUrl" value="https://hannahenglishcourse.netlify.app">

  <div class="row">
    <div style="flex:1">
      <label>Level</label>
      <input id="level" value="Level0">
    </div>
    <div style="flex:1">
      <label>Unit</label>
      <input id="unit" value="Unit1">
    </div>
  </div>

  <div class="row">
    <div style="flex:1">
      <label>N√≠vel CEFR</label>
      <select id="cefr">
        <option>Starter</option>
        <option>Pre-A1</option>
        <option>A1</option>
        <option>A2</option>
        <option>B1</option>
        <option>B2</option>
        <option>C1</option>
        <option>C2</option>
      </select>
    </div>
  </div>

</div>

<div class="row" style="margin:14px 0">
  <button id="btnLoad">Carregar dados do Netlify</button>
  <button id="btnGen">Gerar prompt</button>
  <button id="btnCopy" class="ghost">Copiar prompt</button>
  <span id="msg" class="badge"></span>
</div>

<div class="card">
  <label>Texto b√≠blico inspirador (edit√°vel)</label>
  <textarea id="bibtext"></textarea>
</div>

<div class="card">
  <label>Tema gramatical (edit√°vel)</label>
  <textarea id="theme"></textarea>
</div>

<div class="card">
  <label>Prompt gerado</label>
  <textarea id="out" class="small" readonly></textarea>
</div>

</div>

<script>
(function(){

const baseEl = document.getElementById('baseUrl');
const levelEl = document.getElementById('level');
const unitEl = document.getElementById('unit');
const cefrEl = document.getElementById('cefr');

const bibEl = document.getElementById('bibtext');
const themeEl = document.getElementById('theme');

const outEl = document.getElementById('out');
const msgEl = document.getElementById('msg');

function normalizeBaseUrl(url){
  return (url || '').trim().replace(/\/+$/, '');
}

function joinUrl(base, path){
  base = normalizeBaseUrl(base);
  if(!path.startsWith('/')) path = '/' + path;
  return base + path;
}

async function fetchText(url){
  const res = await fetch(url, {cache:'no-store'});
  if(!res.ok) throw new Error("Erro: " + url);
  return await res.text();
}

async function fetchJSON(url){
  const res = await fetch(url, {cache:'no-store'});
  if(!res.ok) throw new Error("Erro: " + url);
  return await res.json();
}

/**
 * IMPORTANTE:
 * - Aqui foi alterado SOMENTE o texto do prompt gerado (buildPrompt),
 *   para exigir:
 *   (1) dois blocos separados (GRAMMAR e IMAGENS),
 *   (2) ambos em blocos de c√≥digo,
 *   (3) comandos vis√≠veis (n√£o renderizados),
 *   (4) nada fora dos blocos.
 */
function buildPrompt(bib, theme, cefr, level, unit){

return `
Quero que voc√™ crie um arquivo de gram√°tica chamado "texto.txt" para crian√ßas pequenas iniciantes em ingl√™s (${cefr} CEFR) que aprendem pelo meu aplicativo que ensina ingl√™s atrav√©s de hist√≥rias da B√≠blia. O conte√∫do deve ser adaptado ao p√∫blico infantil: l√∫dico, ilustrado, organizado e eficaz ‚Äî inspirado em um pequeno texto b√≠blico inspirador e que alcance os objetivos do TEMA GRAMATICAL.
Essa gram√°tica al√©m de poder ser estudada individualmente pelo aluno, vai servir como recurso de apresenta√ß√£o do professor durante a aula.
Crie o texto.txt para que tenha excel√™ncia de did√°tica. O texto.txt deve conter um t√≠tulo seguido da se√ß√£o GRAMMAR que cont√©m subt√≠tulos. Voc√™ deve usar recursos como imagens e tabelas que ilustram e auxiliam a explica√ß√£o. Ao final coloque a se√ß√£o IMAGENS que deve conter descri√ß√£o detalhada de cada imagem que voc√™ julgou necess√°ria √† explica√ß√£o (GRAMMAR) para que outra IA posteriormente gere corretamente essa imagem (prompt).

=====================
CONFIGURA√á√ÉO
=====================
Level: ${level}
Unit: ${unit}
N√≠vel CEFR: ${cefr}

=====================
B√çBLIA ‚Äî INSPIRA√á√ÉO
=====================
${bib}

====================
TEMA GRAMATICAL
====================
${theme}

====================
OBJETIVO DO GERADOR
====================
Gerar SOMENTE o conte√∫do do arquivo "texto.txt", mas dividido em DOIS BLOCOS separados (GRAMMAR e IMAGENS), seguindo fielmente o formato descrito abaixo.
N√£o comentar e n√£o explicar nada fora dos blocos.

=========================
FORMATO (OBRIGAT√ìRIO)
=========================

A resposta deve conter EXATAMENTE 2 BLOCOS de c√≥digo, nesta ordem:

1) BLOCO GRAMMAR
2) BLOCO IMAGENS

‚ùóN√ÉO escrever NADA fora dos blocos.
‚ùóN√ÉO misturar GRAMMAR com IMAGENS no mesmo bloco.

-------------------------
BLOCO 1 ‚Äî GRAMMAR
-------------------------
Deve conter APENAS:
Title
# GRAMMAR
conte√∫do completo com subt√≠tulos, imagens e tabelas

Deve estar dentro deste formato (com id fixo):

\`\`\`id="grammar_canva"
Title: >>> title in English

# GRAMMAR
>>> short intro

## 1. >>> subtitle
#IMG:>>>imagem1.png
>>> explanation (kids, short, clear)

TableStart
Coluna1 | Coluna2
itemA | itemB
itemC | itemD
TableEnd
\`\`\`

-------------------------
BLOCO 2 ‚Äî IMAGENS
-------------------------
Deve conter APENAS a se√ß√£o de imagens (descri√ß√µes) e estar dentro deste formato (com id fixo):

\`\`\`id="images_canva"
# IMAGENS
Imagem1: >>> detailed description (prompt)
Imagem2: >>> detailed description (prompt)
\`\`\`

=====================
REGRAS ESSENCIAIS
=====================
‚úî Idioma: ingl√™s
‚úî P√∫blico: crian√ßas pequenas (${cefr})
‚úî Conectar o conte√∫do √† inspira√ß√£o b√≠blica
‚úî Explica√ß√µes curtas, claras, carinhosas
‚úî Manter t√≠tulo, # GRAMMAR, se√ß√µes e tabelas
‚úî Usar ## para subt√≠tulo
‚úî Usar "#IMG:" antes de cada imagem citada na GRAMMAR
‚úî Usar **negrito** apenas fora de tabelas (mas como texto literal, com os asteriscos vis√≠veis)
‚úî N√ÉO usar negrito/it√°lico dentro de tabelas
‚úî Manter "TableStart" / "TableEnd" exatamente
‚úî N√ÉO renderizar formata√ß√£o: os comandos devem aparecer como texto literal (ex: **word**, ##, #IMG:)
‚úî A resposta final deve conter exatamente 2 blocos de c√≥digo e NADA fora deles

Agora, gere apenas o conte√∫do do arquivo "texto.txt" seguindo as regras.
`.trim();

}

// üîµ CARREGAR DO NETLIFY
document.getElementById('btnLoad').addEventListener('click', async ()=>{

  try{

    msgEl.textContent = "Carregando...";

    const base = baseEl.value.trim();
    const level = levelEl.value.trim();
    const unit = unitEl.value.trim();

    // TEXTO INSPIRADOR
    const storyUrl = joinUrl(base, `/${level}/${unit}/DataStory/images.txt`);
    const bib = await fetchText(storyUrl);

    // GRAM√ÅTICA
    const grammarUrl = joinUrl(base, `/grammar/grammar.json`);
    const grammarJSON = await fetchJSON(grammarUrl);

    if(!grammarJSON[level] || !grammarJSON[level][unit]){
      throw new Error("Gram√°tica n√£o encontrada");
    }

    const theme = grammarJSON[level][unit].join(', ');

    // Preenche campos edit√°veis
    bibEl.value = bib;
    themeEl.value = theme;

    msgEl.textContent = "‚úÖ Dados carregados";

  }catch(e){
    console.error(e);
    msgEl.textContent = "‚ùå Erro ao carregar dados";
  }

});

// üü¢ GERAR PROMPT (USA OS CAMPOS)
document.getElementById('btnGen').addEventListener('click', ()=>{

  const bib = bibEl.value.trim();
  const theme = themeEl.value.trim();
  const cefr = cefrEl.value;
  const level = levelEl.value.trim();
  const unit = unitEl.value.trim();

  if(!bib || !theme){
    msgEl.textContent = "‚ö† Preencha ou carregue os dados primeiro";
    return;
  }

  const prompt = buildPrompt(bib, theme, cefr, level, unit);

  outEl.value = prompt;
  msgEl.textContent = "‚úÖ Prompt gerado";

});

// üìã COPIAR
document.getElementById('btnCopy').addEventListener('click', async()=>{
  try{
    await navigator.clipboard.writeText(outEl.value);
    msgEl.textContent = "Copiado!";
  }catch{
    outEl.select();
    document.execCommand('copy');
  }
});

})();
</script>

</body>
</html>