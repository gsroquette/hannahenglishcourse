<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hannah ‚Äî Prompt Builder (Gera√ß√£o de Quest√µes JSON)</title>
  <style>
    :root { --bg:#0b1220; --card:#0f1a33; --muted:#8aa0c8; --text:#e9f0ff; --accent:#61dafb; --border:#1f2f55; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:linear-gradient(180deg,var(--bg),#050914); color:var(--text); }
    .wrap { max-width:1100px; margin:0 auto; padding:22px; }
    h1 { margin:0 0 6px; font-size:20px; letter-spacing:.2px; }
    .sub { margin:0 0 18px; color:var(--muted); font-size:13px; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }
    .card { background:rgba(15,26,51,.86); border:1px solid var(--border); border-radius:14px; padding:14px; box-shadow: 0 8px 30px rgba(0,0,0,.25); }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media (max-width: 540px){ .row{ grid-template-columns:1fr; } }

    label { display:block; font-size:12px; color:var(--muted); margin:0 0 6px; }
    input, select, textarea {
      width:100%; box-sizing:border-box;
      background:#071127; color:var(--text);
      border:1px solid var(--border);
      border-radius:10px; padding:10px 10px;
      outline:none;
    }
    textarea { min-height:160px; resize:vertical; line-height:1.35; }
    .small { font-size:12px; color:var(--muted); margin-top:6px; }
    .btnbar { display:flex; flex-wrap:wrap; gap:10px; margin-top:10px; }
    button {
      border:1px solid var(--border);
      background:#0a1733;
      color:var(--text);
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
    }
    button.primary { border-color: rgba(97,218,251,.35); background: rgba(97,218,251,.14); }
    button:disabled { opacity:.5; cursor:not-allowed; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); color:var(--muted); font-size:12px; }
    .ok { color:#a6ffbf; }
    .warn { color:#ffdba6; }
    .err { color:#ffb0b0; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .split { display:grid; grid-template-columns: 1fr; gap:10px; }
    .hint { color:var(--muted); font-size:12px; }
    .footer { margin-top:14px; color:var(--muted); font-size:12px; }
    .hr { height:1px; background: rgba(31,47,85,.9); margin:12px 0; }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>üß† Prompt Builder ‚Äî Hannah English Course</h1>
    <p class="sub">Gera o <span class="mono">PROMPT DEFINITIVO COMPLETO</span> e carrega automaticamente <span class="mono">images.txt</span> e <span class="mono">words.txt</span> (data1‚Äìdata3) do Netlify.</p>

    <div class="grid">
      <!-- LEFT: Inputs -->
      <div class="card">
        <h2 style="margin:0 0 10px; font-size:15px;">1) Entradas e Carregamento</h2>

        <div class="row">
          <div>
            <label for="baseUrl">Base URL (Netlify)</label>
            <input id="baseUrl" value="https://hannahenglishcourse.netlify.app" />
            <div class="small">Sem barra no final. Ex.: <span class="mono">https://hannahenglishcourse.netlify.app</span></div>
          </div>

          <div>
            <label for="cefr">N√≠vel CEFR (para o prompt)</label>
            <select id="cefr">
              <option value="Starter" selected>Starter</option>
              <option value="Pre-A1">Pre-A1</option>
              <option value="A1">A1</option>
              <option value="A2">A2</option>
              <option value="B1">B1</option>
              <option value="B2">B2</option>
              <option value="C1">C1</option>
              <option value="C2">C2</option>
            </select>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label for="level">Level (path segment)</label>
            <input id="level" value="Level0" />
            <div class="small">Usado em URLs: <span class="mono">/{level}/{unit}/...</span></div>
          </div>
          <div>
            <label for="unit">Unit (path segment)</label>
            <input id="unit" value="unit4" />
            <div class="small">Ex.: <span class="mono">unit4</span> (conforme seu padr√£o no Netlify)</div>
          </div>
        </div>

        <div class="btnbar">
          <button class="primary" id="btnLoadAll">Carregar do Netlify (texto + data1‚Äìdata3)</button>
          <span class="pill" id="statusPill">Status: <span class="warn" id="statusText">Aguardando</span></span>
        </div>

        <div class="hr"></div>

        <div class="split">
          <div>
            <label for="inspirer">Texto inspirador (images.txt)</label>
            <textarea id="inspirer" placeholder="Clique em 'Carregar' ou cole aqui o conte√∫do do images.txt..."></textarea>
            <div class="small">Caminho esperado: <span class="mono">/{level}/{unit}/DataStory/images.txt</span></div>
          </div>

          <div class="row">
            <div>
              <label for="groupA">Grupo A (data1/words.txt)</label>
              <textarea id="groupA" placeholder="Carregar do Netlify ou colar aqui (1 palavra por linha, UPPERCASE)..."></textarea>
              <div class="small">Caminho: <span class="mono">/{level}/{unit}/data1/words.txt</span></div>
            </div>
            <div>
              <label for="groupB">Grupo B (data2/words.txt)</label>
              <textarea id="groupB" placeholder="Carregar do Netlify ou colar aqui (1 palavra por linha, UPPERCASE)..."></textarea>
              <div class="small">Caminho: <span class="mono">/{level}/{unit}/data2/words.txt</span></div>
            </div>
          </div>

          <div>
            <label for="groupC">Grupo C (data3/words.txt)</label>
            <textarea id="groupC" placeholder="Carregar do Netlify ou colar aqui (1 palavra por linha, UPPERCASE)..."></textarea>
            <div class="small">Caminho: <span class="mono">/{level}/{unit}/data3/words.txt</span></div>
          </div>
        </div>

        <div class="footer">
          Observa√ß√£o: se <span class="mono">data3/words.txt</span> n√£o existir para uma unidade, o campo Grupo C pode ficar vazio (o prompt ainda ser√° gerado).
        </div>
      </div>

      <!-- RIGHT: Output -->
      <div class="card">
        <h2 style="margin:0 0 10px; font-size:15px;">2) Prompt Final (gerado)</h2>

        <div class="btnbar" style="margin-top:0;">
          <button class="primary" id="btnGenerate">Gerar Prompt Completo</button>
          <button id="btnCopy" disabled>Copiar</button>
          <span class="pill">Contagem: <span class="mono" id="countInfo">0 chars</span></span>
        </div>

        <div style="margin-top:10px;">
          <label for="outPrompt">Sa√≠da</label>
          <textarea id="outPrompt" class="mono" placeholder="O prompt completo aparecer√° aqui..." style="min-height:520px;"></textarea>
          <div class="hint" id="copyHint"></div>
        </div>

        <div class="hr"></div>

        <div class="footer">
          Compat√≠vel com Safari/Chrome: usa <span class="mono">navigator.clipboard</span> com fallback para <span class="mono">execCommand('copy')</span>.
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // Helpers
    // =========================
    function $(id){ return document.getElementById(id); }

    function normalizeBaseUrl(url){
      return String(url || "").trim().replace(/\/+$/, "");
    }

    function normalizePathSegment(seg){
      // Keep user‚Äôs casing, only trim and remove leading/trailing slashes.
      return String(seg || "").trim().replace(/^\/+|\/+$/g, "");
    }

    function joinUrl(base, path){
      base = normalizeBaseUrl(base);
      path = String(path || "").trim();
      if (!path.startsWith("/")) path = "/" + path;
      return base + path;
    }

    function setStatus(type, msg){
      const el = $("statusText");
      el.textContent = msg;
      el.className = type; // ok | warn | err
    }

    function parseWords(raw){
      // 1 word per line, uppercase. We keep uppercase, but also trim and remove blanks.
      const lines = String(raw || "")
        .split(/\r?\n/)
        .map(s => s.trim())
        .filter(Boolean);
      // Keep as-is, but enforce uppercase display (won't change meaning).
      return lines.map(w => w.toUpperCase());
    }

    function wordsToTextarea(words){
      return words.join("\n");
    }

    async function fetchText(url){
      const res = await fetch(url, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status + " ‚Äî " + url);
      return await res.text();
    }

    // Clipboard (Safari-safe)
    async function copyToClipboard(text){
      // Modern API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      // Fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.setAttribute("readonly", "");
      ta.style.position = "fixed";
      ta.style.top = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, ta.value.length);
      let ok = false;
      try { ok = document.execCommand("copy"); } catch(e) { ok = false; }
      document.body.removeChild(ta);
      return ok;
    }

    function updateCount(){
      const txt = $("outPrompt").value || "";
      $("countInfo").textContent = txt.length + " chars";
      $("btnCopy").disabled = txt.trim().length === 0;
    }

    // =========================
    // Prompt Template (FULL)
    // =========================
    function buildFullPrompt(params){
      const {
        inspirerText,
        groupA,
        groupB,
        groupC,
        level,
        unit,
        cefr
      } = params;

      // Important: Keep the prompt rigid (no improvisation). Insert only the dynamic parts.
      // Also: user wants "Level / Unit" and CEFR inside prompt.
      return [
`üß† PROMPT DEFINITIVO COMPLETO`,
`GERA√á√ÉO DE QUEST√ïES ‚Äî Hannah English Course`,
``,
`‚ö†Ô∏è INSTRU√á√ïES GERAIS (OBRIGAT√ìRIAS)`,
``,
`Voc√™ √© uma IA respons√°vel por gerar quest√µes pedag√≥gicas estruturadas em JSON para o aplicativo Hannah English Course.`,
``,
`Siga rigorosamente todas as regras abaixo.`,
`Este sistema n√£o tolera improvisa√ß√µes.`,
``,
`‚ùå √â PROIBIDO`,
``,
`Inventar palavras`,
`Inventar caminhos de arquivos`,
`Alterar a estrutura do JSON`,
`Incrementar imagens automaticamente`,
`Usar palavras fora dos arquivos fornecidos`,
`Misturar grupos de palavras`,
``,
`1Ô∏è‚É£ TEXTO INSPIRADOR (FONTE √öNICA DE CONTEXTO)`,
``,
`O usu√°rio sempre fornecer√° um texto inspirador, dividido em trechos associados a imagens.`,
``,
`üìå Exemplo de formato`,
`(O texto real sempre ser√° fornecido pelo usu√°rio):`,
``,
`#title: The Baby God Promised (Genesis 21)`,
``,
`#imagem1`,
`"Abraham and Sarah lived in Canaan. They were very old, but they loved God."`,
``,
`#imagem2`,
`"God said, 'You will have a baby.' Sarah laughed and said, 'I am ninety years old!'"`,
``,
`#imagem3`,
`"God said, 'Nothing is too hard for Me.' Abraham believed God's promise."`,
``,
`#imagem4`,
`"One day, Sarah had a baby boy. Abraham named him Isaac. They counted his tiny fingers - one, two, three... ten!"`,
``,
`#imagem5`,
`"Sarah smiled and said, 'God has made me laugh with joy!' God keeps His promises. How old are you? God loves you too!"`,
``,
`üîë REGRA FUNDAMENTAL ‚Äî IMAGEM`,
``,
`A imagem representa o TRECHO, n√£o a quest√£o.`,
``,
`‚û°Ô∏è Todas as quest√µes derivadas de #imagemX DEVEM usar exatamente esta imagem:`,
``,
`"image": "/${level}/${unit}/DataStory/images/imagemX.png"`,
``,
`üö´ Nunca incremente o n√∫mero da imagem por conta pr√≥pria.`,
``,
`2Ô∏è‚É£ ARQUIVOS DE PALAVRAS (FONTE √öNICA DE VOCABUL√ÅRIO)`,
``,
`Al√©m do texto, o usu√°rio sempre fornecer√° arquivos (TXT, Word, etc.) com listas de palavras, organizadas em grupos.`,
``,
`Esses arquivos determinam EXATAMENTE:`,
``,
`quais palavras podem virar ___`,
`quais palavras podem aparecer como alternativas`,
`quais caminhos de imagem e som devem ser usados`,
``,
`3Ô∏è‚É£ GRUPOS DE PALAVRAS ‚Üí PASTAS (REGRA CR√çTICA)`,
``,
`Cada grupo de palavras corresponde diretamente a uma pasta dataX.`,
``,
`üìÇ Grupo A ‚Üí data1`,
``,
`‚û°Ô∏è Caminho base:`,
`/${level}/${unit}/data1/`,
``,
`üî¢ Regra de numera√ß√£o (OBRIGAT√ìRIA)`,
`Ordem no arquivo\tImagem\tSom`,
`1¬™ palavra\timagem1.png\tsom1.mp3`,
`2¬™ palavra\timagem2.png\tsom2.mp3`,
`3¬™ palavra\timagem3.png\tsom3.mp3`,
``,
`üìå Exemplo de uso correto:`,
``,
`"audio": "/${level}/${unit}/data1/sounds/som2.mp3"`,
``,
`üìÇ Grupo B ‚Üí data2`,
``,
`‚û°Ô∏è Caminhos:`,
`/${level}/${unit}/data2/imagens/imagemX.png`,
`/${level}/${unit}/data2/sounds/somX.mp3`,
``,
`üìÇ Grupo C ‚Üí data3 (se existir)`,
``,
`Mesmo padr√£o.`,
`‚ö†Ô∏è A l√≥gica NUNCA MUDA.`,
``,
`‚ö†Ô∏è REGRAS ABSOLUTAS SOBRE GRUPOS`,
``,
`A IA N√ÉO pode misturar grupos`,
`A IA N√ÉO pode inventar X`,
`O n√∫mero do asset vem EXCLUSIVAMENTE da posi√ß√£o da palavra no arquivo`,
`Se a palavra est√° no Grupo B, use data2 ‚Äî nunca data1 ou data3`,
``,
`4Ô∏è‚É£ COMO GERAR AS QUEST√ïES (L√ìGICA OBRIGAT√ìRIA)`,
``,
`Para cada trecho #imagemX:`,
``,
`Analise as frases do trecho`,
`Identifique palavras:`,
``,
`que estejam no texto`,
`e tamb√©m nos arquivos de palavras`,
``,
`Escolha UMA palavra por quest√£o para ocultar`,
`Substitua a palavra por ___ no prompt`,
``,
`Monte alternativas:`,
`1 correta (palavra ocultada)`,
`1 ou mais distratores (do mesmo grupo)`,
``,
`Gere mais de uma quest√£o por imagem, se fizer sentido pedag√≥gico`,
``,
`5Ô∏è‚É£ ESTRUTURA OBRIGAT√ìRIA DO BLOCO (JSON)`,
``,
`‚ö†Ô∏è Quando gerar mais de uma quest√£o, o JSON DEVE ter este cabe√ßalho:`,
``,
`{`,
`  "title": "Vocabulary",`,
`  "questions": [`,
`    { ... },`,
`    { ... }`,
`  ]`,
`}`,
``,
`üö´ Sem esse cabe√ßalho, o bloco N√ÉO ser√° lido pelo app.`,
``,
`6Ô∏è‚É£ ESTRUTURA OBRIGAT√ìRIA DE CADA QUEST√ÉO (JSON)`,
``,
`‚ö†Ô∏è Use EXATAMENTE este formato`,
`‚ö†Ô∏è label, value e answer devem estar em Title Case`,
``,
`{`,
`  "type": "fillblank",`,
`  "prompt": "Texto com ___ no lugar da palavra escondida",`,
`  "image": "/${level}/${unit}/DataStory/images/imagemX.png",`,
`  "options": [`,
`    {`,
`      "label": "Word",`,
`      "value": "Word",`,
`      "audio": "/${level}/${unit}/dataY/sounds/somZ.mp3"`,
`    },`,
`    {`,
`      "label": "Other",`,
`      "value": "Other",`,
`      "audio": "/${level}/${unit}/dataY/sounds/somW.mp3"`,
`    }`,
`  ],`,
`  "answer": "Word",`,
`  "promptAudio": "/${level}/${unit}/QA/promptN.mp3"`,
`}`,
``,
`üö´ N√£o adicionar campos extras`,
`üö´ N√£o remover campos`,
``,
`7Ô∏è‚É£ √ÅUDIO DO PROMPT (OBRIGAT√ìRIO)`,
``,
`Toda quest√£o deve conter promptAudio`,
``,
`Numera√ß√£o:`,
``,
`segue a ordem sequencial das quest√µes`,
``,
`Caminho obrigat√≥rio:`,
``,
`/${level}/${unit}/QA/promptN.mp3`,
``,
`8Ô∏è‚É£ SA√çDA ESPERADA DA IA`,
``,
`Retorne APENAS JSON`,
``,
`Sempre que houver mais de uma quest√£o, use:`,
``,
`title`,
``,
`questions: []`,
``,
`üö´ N√£o explique`,
`üö´ N√£o comente`,
`üö´ N√£o adicione texto fora do JSON`,
``,
`üéØ OBJETIVO FINAL`,
``,
`Gerar quest√µes que:`,
``,
`sejam fi√©is ao texto inspirador`,
`usem exclusivamente as palavras fornecidas`,
`respeitem rigorosamente os grupos e caminhos`,
`funcionem imediatamente no app, sem ajustes manuais`,
``,
`üìù ENTRADAS DO USU√ÅRIO (PREENCHA ABAIXO)`,
`üîπ N√≠vel CEFR (Aluno)`,
`${cefr}`,
``,
`üîπ Level / Unit`,
`${level} / ${unit}`,
``,
`üîπ Texto inspirador real (com #imagemX)`,
`${inspirerText.trim()}`,
``,
`üîπ Arquivos / listas de palavras`,
``,
`(Grupos A, B, C ‚Äî se houver)`,
``,
`GrupoA: ${groupA.join("\n")}`,
``,
`GRUPOB: ${groupB.join("\n")}`,
``,
`GRUPO C: ${groupC.length ? groupC.join("\n") : ""}`
      ].join("\n");
    }

    // =========================
    // Loaders
    // =========================
    async function loadAll(){
      const baseUrl = normalizeBaseUrl($("baseUrl").value);
      const level = normalizePathSegment($("level").value);
      const unit = normalizePathSegment($("unit").value);

      const urlImages = joinUrl(baseUrl, `/${level}/${unit}/DataStory/images.txt`);
      const urlA = joinUrl(baseUrl, `/${level}/${unit}/data1/words.txt`);
      const urlB = joinUrl(baseUrl, `/${level}/${unit}/data2/words.txt`);
      const urlC = joinUrl(baseUrl, `/${level}/${unit}/data3/words.txt`);

      setStatus("warn", "Carregando...");
      $("btnLoadAll").disabled = true;

      try{
        const [imagesTxt, aTxt, bTxt] = await Promise.all([
          fetchText(urlImages),
          fetchText(urlA),
          fetchText(urlB)
        ]);

        $("inspirer").value = imagesTxt.trim();

        const aWords = parseWords(aTxt);
        const bWords = parseWords(bTxt);
        $("groupA").value = wordsToTextarea(aWords);
        $("groupB").value = wordsToTextarea(bWords);

        // data3 pode n√£o existir ‚Äî tentamos e, se falhar, apenas deixamos vazio.
        try{
          const cTxt = await fetchText(urlC);
          const cWords = parseWords(cTxt);
          $("groupC").value = wordsToTextarea(cWords);
        }catch(_e){
          $("groupC").value = "";
        }

        setStatus("ok", "Carregado com sucesso");
      }catch(e){
        console.error(e);
        setStatus("err", "Erro ao carregar (ver console)");
        alert("Falha ao carregar do Netlify.\n\nDetalhe: " + (e && e.message ? e.message : String(e)));
      }finally{
        $("btnLoadAll").disabled = false;
      }
    }

    function generatePrompt(){
      const inspirerText = $("inspirer").value || "";
      const aRaw = $("groupA").value || "";
      const bRaw = $("groupB").value || "";
      const cRaw = $("groupC").value || "";

      const level = normalizePathSegment($("level").value);
      const unit = normalizePathSegment($("unit").value);
      const cefr = $("cefr").value;

      const groupA = parseWords(aRaw);
      const groupB = parseWords(bRaw);
      const groupC = parseWords(cRaw);

      const prompt = buildFullPrompt({
        inspirerText,
        groupA,
        groupB,
        groupC,
        level,
        unit,
        cefr
      });

      $("outPrompt").value = prompt;
      $("copyHint").textContent = "";
      updateCount();
    }

    // =========================
    // Events
    // =========================
    $("btnLoadAll").addEventListener("click", loadAll);
    $("btnGenerate").addEventListener("click", generatePrompt);

    $("btnCopy").addEventListener("click", async () => {
      const text = $("outPrompt").value || "";
      if (!text.trim()) return;

      const ok = await copyToClipboard(text);
      $("copyHint").textContent = ok ? "‚úÖ Copiado." : "‚ö†Ô∏è N√£o foi poss√≠vel copiar automaticamente. Selecione o texto e copie manualmente.";
    });

    $("outPrompt").addEventListener("input", updateCount);
    updateCount();
  </script>
</body>
</html>