<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador de Prompt Hannah</title>

<style>
body {
  font-family: Arial;
  margin: 20px;
}

textarea, input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

button:hover { background: #1e4ed8; }

.copyBtn { background: #10b981; }

.status {
  margin-top: 10px;
  background: #f3f4f6;
  padding: 10px;
  border-radius: 8px;
  white-space: pre-line;
}

</style>
</head>

<body>

<h2>Gerador de Prompt Hannah (Vers√£o Final)</h2>

<label>Base URL:</label>
<input id="baseUrl" value="https://hannahenglishcourse.netlify.app">

<label>Li√ß√£o (FONTE PRINCIPAL):</label>
<textarea id="lessonInput"></textarea>

<label>Texto Inspirador (opcional):</label>
<textarea id="inspirationInput"></textarea>

<label>N√≠vel:</label>
<select id="levelName">
  <option value="Starter">Starter</option>
  <option value="A1">A1</option>
  <option value="A2">A2</option>
</select>

<label>Level:</label>
<input id="levelNumber" value="0">

<label>Unit:</label>
<input id="unitNumber" value="3">

<button onclick="gerarPrompt()">Gerar Prompt</button>
<button class="copyBtn" onclick="copiarPrompt()">Copiar Prompt</button>

<div class="status" id="status"></div>

<label>Prompt Gerado:</label>
<textarea id="output" style="height:450px;"></textarea>

<script>

// ===== Helpers =====

function log(msg){
  document.getElementById("status").innerText += msg + "\n";
}

async function fetchText(url){
  try{
    const res = await fetch(url);
    if(!res.ok) throw "Erro";
    return await res.text();
  }catch(e){
    log("Erro: " + url);
    return null;
  }
}

function parseWords(txt){
  if(!txt) return [];
  return txt.split(/\r?\n/).map(x=>x.trim()).filter(x=>x);
}

function unique(arr){
  return [...new Set(arr)];
}

// ===== Fetch Words =====

async function getWords(base, level, unit){
  let words = [];

  for(let i=1;i<=3;i++){
    const url = `${base}/Level${level}/Unit${unit}/data${i}/words.txt`;
    const txt = await fetchText(url);
    if(txt){
      words.push(...parseWords(txt));
    }
  }

  return words;
}

// ===== Fetch Grammar =====

async function getGrammar(base){
  const txt = await fetchText(base + "/grammar/grammar.json");
  if(!txt) return {};
  return JSON.parse(txt);
}

// ===== Main =====

async function gerarPrompt(){

  document.getElementById("status").innerText = "";

  const base = document.getElementById("baseUrl").value;
  const lesson = document.getElementById("lessonInput").value;
  const inspiration = document.getElementById("inspirationInput").value;
  const levelName = document.getElementById("levelName").value;

  let level = parseInt(document.getElementById("levelNumber").value);
  let unit = parseInt(document.getElementById("unitNumber").value);

  if(!lesson){
    alert("Insira a li√ß√£o");
    return;
  }

  log("Buscando vocabul√°rio...");

  let current = await getWords(base, level, unit);
  let prev1 = await getWords(base, level, unit-1);
  let prev2 = await getWords(base, level, unit-2);

  let vocab = unique([...current, ...prev1, ...prev2]).slice(0,200);

  log("Buscando gram√°tica...");

  const grammarData = await getGrammar(base);

  let grammar = [];

  for(let i=unit; i>=unit-2; i--){
    if(grammarData["Level"+level] && grammarData["Level"+level]["Unit"+i]){
      grammar.push(...grammarData["Level"+level]["Unit"+i]);
    }
  }

  grammar = unique(grammar);

  const basicWords = [
    "I","YOU","HE","SHE","IT","WE","THEY",
    "MY","YOUR","HIS","HER",
    "A","AN","THE",
    "AM","IS","ARE",
    "YES","NO",
    "WHAT","HOW","WHO","WHERE",
    "AND","OR","BUT",
    "PLEASE","THANK YOU",
    "OK","HELLO","HI","GOOD MORNING","GOODBYE"
  ];

  // ===== PROMPT FINAL =====

  const prompt = `
Voc√™ √© um gerador de di√°logos para ensino de ingl√™s.

üî¥ REGRA M√ÅXIMA
A LI√á√ÉO √© a fonte principal. O di√°logo deve ensinar exatamente essa li√ß√£o.

üî¥ IMPORTANTE (ORDEM)
1) Gerar
2) Revisar
3) Validar
N√ÉO misture as etapas.

N√çVEL: ${levelName}

CONTROLE DE COMPLEXIDADE (OBRIGAT√ìRIO)
- Linguagem muito simples
- Frases curtas (2 a 6 palavras)
- Evitar descri√ß√£o
- N√£o adicionar ideias novas
- Focar apenas na pr√°tica da li√ß√£o

GRAM√ÅTICA PERMITIDA:
${grammar.map(g=>"- "+g).join("\n")}

USO OBRIGAT√ìRIO DAS FRASES-ALVO
- Usar exatamente as frases da li√ß√£o
- N√£o substituir por sin√¥nimos
- Repetir pelo menos 3 vezes

ESTRUTURA DO DI√ÅLOGO
- M√≠nimo 3 ciclos
- Cada ciclo:
  1 pergunta + 1 resposta

Exemplo:
How old are you?
I am six years old.

BASIC WORDS:
${basicWords.join(", ")}

REPERT√ìRIO (apenas verifica√ß√£o):
${vocab.join(", ")}

================================
ETAPA 1 - GERAR
================================
- Criar di√°logo baseado na LI√á√ÉO
- Usar frases-alvo
- Repetir estrutura
- Usar frases simples
- N√ÉO usar repert√≥rio como fonte

================================
ETAPA 2 - REVISAR
================================
- Verificar todas as palavras
- Se n√£o estiver na LI√á√ÉO, BASIC ou REPERT√ìRIO:
  ‚Üí substituir
  ‚Üí ou remover

================================
ETAPA 3 - VALIDAR
================================
Verifique:

- Segue a li√ß√£o?
- Frases-alvo repetidas?
- 3 ciclos pergunta/resposta?
- Frases curtas?
- Sem palavras fora do repert√≥rio?
- Sem gram√°tica proibida?

Se houver erro:
- Corrigir antes de entregar

N√£o explicar.
Entregar apenas o di√°logo final.

--- LI√á√ÉO ---
${lesson}

${inspiration ? `
--- TEXTO INSPIRADOR ---
${inspiration}
` : ""}

Agora gere apenas o dialogo.txt
`;

  document.getElementById("output").value = prompt;

  log("Prompt gerado com sucesso.");
}

// ===== Copy =====

function copiarPrompt(){
  const textarea = document.getElementById("output");

  textarea.select();
  textarea.setSelectionRange(0, 99999);

  try{
    document.execCommand("copy");
    alert("Copiado!");
  }catch(e){
    alert("Erro ao copiar");
  }
}

</script>

</body>
</html>
