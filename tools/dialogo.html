<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gerador de Prompt - Hannah</title>

<style>
body { font-family: Arial; margin: 20px; }

textarea, input, select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  padding: 12px;
  margin-top: 10px;
  border: none;
  border-radius: 10px;
  background: #2563eb;
  color: white;
  font-weight: bold;
  cursor: pointer;
}

button:hover { background: #1e4ed8; }

.copyBtn {
  background: #10b981;
}

.status {
  margin-top: 10px;
  background: #f3f4f6;
  padding: 10px;
  border-radius: 8px;
  white-space: pre-line;
}
</style>

</head>
<body>

<h2>Gerador de Prompt (Hannah)</h2>

<label>Base URL:</label>
<input id="baseUrl" value="https://hannahenglishcourse.netlify.app">

<label>Li√ß√£o:</label>
<textarea id="lessonInput"></textarea>

<label>Texto Inspirador (opcional):</label>
<textarea id="inspirationInput"></textarea>

<label>N√≠vel:</label>
<select id="level">
  <option value="Starter">Starter</option>
  <option value="A1">A1</option>
  <option value="A2">A2</option>
</select>

<label>Level:</label>
<input id="levelNumber" value="0">

<label>Unit:</label>
<input id="unitNumber" value="3">

<button onclick="gerarPrompt()">Gerar Prompt</button>
<button class="copyBtn" onclick="copiarPrompt()">Copiar Prompt</button>

<div class="status" id="status"></div>

<label>Prompt:</label>
<textarea id="output" style="height:400px;"></textarea>

<script>

function log(msg){
  document.getElementById("status").innerText += msg + "\n";
}

async function fetchText(url){
  try{
    const res = await fetch(url);
    if(!res.ok) throw "Erro";
    return await res.text();
  }catch(e){
    log("Erro: " + url);
    return null;
  }
}

function parseWords(txt){
  if(!txt) return [];
  return txt.split("\n").map(x => x.trim()).filter(x => x);
}

async function getWords(base, level, unit){
  let words = [];

  for(let i=1;i<=3;i++){
    const url = `${base}/Level${level}/Unit${unit}/data${i}/words.txt`;
    const txt = await fetchText(url);
    if(txt){
      words.push(...parseWords(txt));
    }
  }

  return words;
}

async function getGrammar(base){
  const txt = await fetchText(base + "/grammar/grammar.json");
  if(!txt) return {};
  return JSON.parse(txt);
}

function unique(arr){
  return [...new Set(arr)];
}

async function gerarPrompt(){

  document.getElementById("status").innerText = "";

  const base = document.getElementById("baseUrl").value;
  const lesson = document.getElementById("lessonInput").value;
  const inspiration = document.getElementById("inspirationInput").value;
  const levelName = document.getElementById("level").value;
  const level = parseInt(document.getElementById("levelNumber").value);
  const unit = parseInt(document.getElementById("unitNumber").value);

  log("Buscando palavras...");

  const current = await getWords(base, level, unit);
  const prev1 = await getWords(base, level, unit-1);
  const prev2 = await getWords(base, level, unit-2);

  const vocab = unique([...current, ...prev1, ...prev2]).slice(0,200);

  log("Buscando gram√°tica...");

  const grammarData = await getGrammar(base);

  let grammar = [];

  for(let i=unit;i>=unit-2;i--){
    if(grammarData["Level"+level] && grammarData["Level"+level]["Unit"+i]){
      grammar.push(...grammarData["Level"+level]["Unit"+i]);
    }
  }

  grammar = unique(grammar);

  const basicWords = [
    "I","YOU","HE","SHE","IT","WE","THEY",
    "MY","YOUR","HIS","HER",
    "A","AN","THE",
    "AM","IS","ARE",
    "YES","NO",
    "WHAT","HOW",
    "AND","OR",
    "HELLO","HI","GOODBYE"
  ];

  const prompt = `
Voc√™ √© um gerador de di√°logos para ensino de ingl√™s.

üî¥ REGRA M√ÅXIMA
A LI√á√ÉO √© a fonte principal. O di√°logo deve ensinar essa li√ß√£o.

üî¥ IMPORTANTE
Execute as etapas em ordem:
1) Gerar
2) Revisar
3) Validar
N√ÉO misture as etapas.

N√çVEL: ${levelName}

CONTROLE DE COMPLEXIDADE
- Linguagem muito simples
- Frases curtas
- Evitar descri√ß√£o

GRAM√ÅTICA PERMITIDA:
${grammar.map(x=>"- "+x).join("\n")}

BASIC WORDS:
${basicWords.join(", ")}

REPERT√ìRIO (apenas verifica√ß√£o):
${vocab.join(", ")}

================================
ETAPA 1 - GERAR
================================
Crie um di√°logo ensinando a li√ß√£o.

================================
ETAPA 2 - REVISAR
================================
Substitua palavras fora do repert√≥rio.

================================
ETAPA 3 - VALIDAR
================================
Verifique:
- Segue a li√ß√£o?
- Frases simples?
- Sem palavras fora do repert√≥rio?
- Estrutura pergunta/resposta?

Corrija antes de entregar.

--- LI√á√ÉO ---
${lesson}

--- TEXTO INSPIRADOR ---
${inspiration}

Agora gere apenas o dialogo.txt
`;

  document.getElementById("output").value = prompt;

  log("Pronto.");
}

function copiarPrompt(){
  const txt = document.getElementById("output");
  txt.select();
  document.execCommand("copy");
  alert("Copiado!");
}

</script>

</body>
</html>
